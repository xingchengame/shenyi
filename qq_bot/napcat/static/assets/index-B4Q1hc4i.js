import{j as e,h as m}from"./codemirror-core-DIzFijqu.js";import{b as q,a as M,c as je}from"./chunk-5PILOUBS-C2iqzQ1E.js";import{u as C,c as d,I as _,J as Z,K as be}from"./react-dom-TsCL3mk_.js";import{k as U,P as te,b as A,r as ve,W as w,s as I,M as we,u as Ne}from"./index-B0DyBq9P.js";import{t as N}from"./chunk-6LIX6LVT-v4ufXNaW.js";import{b as ke,c as ye,d as ze,e as Ce}from"./index-OutTOxJU.js";import{b as Me,c as Se,d as Le,e as Ie,f as qe}from"./index-CtZU_f5P.js";import{i as re}from"./chunk-MLPFQTYO-6EVO19Sj.js";import{B as _e}from"./index-3atF2w48.js";import{c as j}from"./chunk-NAV3ZXLI-VwA3667I.js";import{s as Ue,l as Ve}from"./chunk-KVDW62ZT-CdlHxaox.js";import{s as Te}from"./chunk-J6JGI6RM-DVh9RltW.js";import{p as $e,B as Pe}from"./index-Yd9j0tFr.js";import{t as Qe,a as ee}from"./chunk-ML27DD5T-CMfbU3IH.js";import{i as Be}from"./chunk-2QAN2V2R-DjiYH11d.js";import{F as He,a as Fe}from"./index-DhICtZLt.js";import{G as ae}from"./iconBase-ClXMXqAg.js";import{M as Ae,a as We}from"./mirror_selector_modal-CA5mxJns.js";import{u as ne}from"./use-dialog-CRavAmtS.js";import{u as De}from"./use-config-DwrVP63J.js";import{Q as Ee}from"./qq_manager-EQj02-Fv.js";import"./chunk-WQVQ7P2I-B4KcTpLM.js";import"./chunk-M3MASYO7-BtOvSeRL.js";import"./Item-DvdRZmps.js";import"./chunk-SLABUSGS-BX9EgnNv.js";import"./chunk-AXSF7SRE-xAGcR_TS.js";import"./chunk-EN4B57RQ-CeMxVeoS.js";import"./chunk-OH2E76JR-CGA2UWeQ.js";import"./chunk-RJKRL3AU-CjtrMR1U.js";import"./index-CokAva9Y.js";import"./chunk-CAFRINWI-CcU5yOMx.js";const P=({count:s,label:r,size:a="md"})=>{const[t]=C(U.backgroundImage,""),i=!!t;return e.jsx(q,{className:d("backdrop-blur-sm border border-white/40 dark:border-white/10 shadow-sm transition-all",i?"bg-white/10 dark:bg-black/10 hover:bg-white/20 dark:hover:bg-black/20":"bg-white/60 dark:bg-black/40 hover:bg-white/70 dark:hover:bg-black/30",a==="md"?"col-span-8 md:col-span-2":"col-span-2 md:col-span-1"),shadow:"none",children:e.jsxs(M,{className:"items-center md:gap-1 p-1 md:p-2",children:[e.jsx("div",{className:d("flex-1 font-mono font-bold",a==="md"?"text-4xl md:text-5xl":"text-2xl md:text-3xl",i?"text-white drop-shadow-sm":"text-default-700 dark:text-gray-200"),children:s}),e.jsx("div",{className:d("whitespace-nowrap text-nowrap flex-shrink-0 font-medium",a==="md"?"text-sm":"text-xs",i?"text-white/80":"text-default-500"),children:r})]})})};function Oe(){const{data:s,error:r,loading:a,run:t}=_(()=>ve.get("https://hitokoto.152710.xyz/"),{throttleWait:1e3}),i={hitokoto:"凡是过往，皆为序章。",from:"暴风雨",from_who:"莎士比亚"},n=(s==null?void 0:s.data)||(r?i:void 0),[c]=C(U.backgroundImage,""),o=!!c,h=()=>{try{const x=`${n==null?void 0:n.hitokoto} —— ${n==null?void 0:n.from} ${n==null?void 0:n.from_who}`;navigator.clipboard.writeText(x),Z.success("复制成功")}catch{Z.error("复制失败, 请手动复制")}};return e.jsxs("div",{className:"overflow-hidden",children:[e.jsxs("div",{className:"relative flex flex-col items-center justify-center p-4 md:p-6",children:[a&&!n&&e.jsx(te,{}),n&&e.jsxs(e.Fragment,{children:[e.jsx(ke,{className:d("text-4xl mb-4",o?"text-white/30":"text-primary/20")}),e.jsxs("div",{className:d("text-xl font-medium tracking-wide leading-relaxed italic",o?"text-white drop-shadow-sm":"text-default-700 dark:text-gray-200"),children:['" ',n==null?void 0:n.hitokoto,' "']}),e.jsxs("div",{className:"mt-4 flex flex-col items-center text-sm",children:[e.jsxs("span",{className:d("font-bold",o?"text-white/90":"text-primary-500/80"),children:["—— ",n==null?void 0:n.from]}),(n==null?void 0:n.from_who)&&e.jsxs("span",{className:d("text-xs mt-1",o?"text-white/70":"text-default-400"),children:["                ",n==null?void 0:n.from_who]})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(N,{content:"刷新",placement:"top",children:e.jsx(A,{className:d("transition-colors",o?"text-white/60 hover:text-white":"text-default-400 hover:text-primary"),onPress:t,size:"sm",isLoading:a,isIconOnly:!0,radius:"full",variant:"light",children:e.jsx(Me,{})})}),e.jsx(N,{content:"复制",placement:"top",children:e.jsx(A,{className:d("transition-colors",o?"text-white/60 hover:text-white":"text-default-400 hover:text-success"),onPress:h,size:"sm",isIconOnly:!0,radius:"full",variant:"light",children:e.jsx(Se,{})})})]})]})}const Re=({data:s,error:r,loading:a})=>{const[t]=C(U.backgroundImage,""),i=!!t;return e.jsxs(q,{className:d("relative backdrop-blur-sm border border-white/40 dark:border-white/10 overflow-hidden flex-shrink-0 shadow-sm",i?"bg-white/10 dark:bg-black/10":"bg-white/60 dark:bg-black/40"),shadow:"none",radius:"lg",children:[e.jsx(te,{loading:a}),r?e.jsxs(M,{className:"items-center gap-1 justify-center",children:[e.jsx("div",{className:"flex-1 text-content1-foreground",children:"Error"}),e.jsx("div",{className:"whitespace-nowrap text-nowrap flex-shrink-0",children:r.message})]}):e.jsxs(M,{className:"flex-row items-center gap-4 overflow-hidden relative p-4",children:[!i&&e.jsx("div",{className:"absolute right-[-10px] bottom-[-10px] text-7xl text-default-400/10 rotate-12 pointer-events-none dark:hidden",children:e.jsx(_e,{})}),e.jsxs("div",{className:"relative flex-shrink-0 z-10",children:[e.jsx(re,{src:(s==null?void 0:s.avatarUrl)??`https://q1.qlogo.cn/g?b=qq&nk=${s==null?void 0:s.uin}&s=0`,className:"shadow-sm rounded-full w-14 aspect-square ring-2 ring-white/50 dark:ring-white/10"}),e.jsx("div",{className:d("w-3.5 h-3.5 rounded-full absolute right-0.5 bottom-0.5 border-2 border-white dark:border-zinc-900 z-10",s!=null&&s.online?"bg-success-500":"bg-default-400")})]}),e.jsxs("div",{className:"flex-col justify-center z-10",children:[e.jsx("div",{className:d("text-xl font-bold truncate mb-0.5",i?"text-white drop-shadow-sm":"text-default-800 dark:text-gray-100"),children:(s==null?void 0:s.nick)||"未知用户"}),e.jsx("div",{className:d("font-mono text-xs tracking-wider",i?"text-white/80":"text-default-500 opacity-80"),children:(s==null?void 0:s.uin)||"Unknown"})]})]})]})};function Ze(s){return ae({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M14 18V20L16 21V22H8L7.99639 21.0036L10 20V18H2.9918C2.44405 18 2 17.5511 2 16.9925V4.00748C2 3.45107 2.45531 3 2.9918 3H21.0082C21.556 3 22 3.44892 22 4.00748V16.9925C22 17.5489 21.5447 18 21.0082 18H14ZM4 14V16H20V14H4Z"},child:[]}]})(s)}const Ge=/^v?(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$/,W=s=>{if(!s||typeof s!="string")return{valid:!1,normalized:"1.0.0-dev",major:1,minor:0,patch:0,prerelease:"dev",buildmetadata:null};const r=s.trim().match(Ge);if(r){const a=parseInt(r[1],10),t=parseInt(r[2],10),i=parseInt(r[3],10),n=r[4]||null,c=r[5]||null;let o=`${a}.${t}.${i}`;return n&&(o+=`-${n}`),c&&(o+=`+${c}`),{valid:!0,normalized:o,major:a,minor:t,patch:i,prerelease:n,buildmetadata:c}}return{valid:!1,normalized:"1.0.0-dev",major:1,minor:0,patch:0,prerelease:"dev",buildmetadata:null}},le=(s,r)=>{const a=W(s),t=W(r);if(!a.valid||!t.valid)return 0;if(a.major!==t.major)return a.major>t.major?1:-1;if(a.minor!==t.minor)return a.minor>t.minor?1:-1;if(a.patch!==t.patch)return a.patch>t.patch?1:-1;if(a.prerelease&&!t.prerelease)return-1;if(!a.prerelease&&t.prerelease)return 1;if(a.prerelease&&t.prerelease){const i=a.prerelease.split("."),n=t.prerelease.split("."),c=Math.max(i.length,n.length);for(let o=0;o<c;o++){const h=i[o],x=n[o];if(h===void 0)return-1;if(x===void 0)return 1;const u=/^\d+$/.test(h)?parseInt(h,10):NaN,p=/^\d+$/.test(x)?parseInt(x,10):NaN;if(!isNaN(u)&&!isNaN(p)){if(u!==p)return u>p?1:-1;continue}if(!isNaN(u))return-1;if(!isNaN(p))return 1;if(h!==x)return h>x?1:-1}}return 0},Ke=(s,r)=>{const a=W(s),t=W(r);return!a.valid||!t.valid?!1:le(r,s)>0},F=({title:s,value:r="--",icon:a,endContent:t,hasBackground:i=!1,onClick:n,clickable:c=!1})=>e.jsxs("div",{className:d("flex text-sm gap-3 py-2 items-baseline transition-colors",i?"text-white/90":"text-default-600 dark:text-gray-300",c&&"cursor-pointer hover:bg-default-100/50 dark:hover:bg-default-800/30 rounded-lg -mx-2 px-2"),onClick:n,children:[e.jsx("div",{className:"text-lg opacity-70 self-center",children:a}),e.jsx("div",{className:"w-24 font-medium",children:s}),e.jsx("div",{className:d("text-xs font-mono flex-1",i?"text-white/80":"text-default-500"),children:r}),e.jsx("div",{className:"self-center",children:t})]}),R=({currentVersion:s,latestVersion:r,status:a,errorMessage:t})=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4 px-6 py-8 bg-default-50 dark:bg-default-100/5 rounded-xl border border-default-100 dark:border-default-100/10",children:[e.jsxs("div",{className:"flex flex-col items-center gap-2 min-w-0 w-full sm:w-auto",children:[e.jsx("span",{className:"text-xs text-default-500 font-medium uppercase tracking-wider",children:"当前版本"}),e.jsx(N,{content:`v${s}`,children:e.jsxs(j,{size:"md",variant:"flat",color:"default",classNames:{content:"font-mono font-bold text-sm truncate max-w-[120px] sm:max-w-[160px]"},children:["v",s]})})]}),e.jsx("div",{className:"flex flex-col items-center text-primary-500 px-4 shrink-0",children:e.jsx("div",{className:"p-2 rounded-full bg-primary-50 dark:bg-primary-900/20",children:e.jsx("svg",{className:"w-6 h-6 animate-pulse rotate-90 sm:rotate-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 8l4 4m0 0l-4 4m4-4H3"})})})}),e.jsxs("div",{className:"flex flex-col items-center gap-2 min-w-0 w-full sm:w-auto",children:[e.jsx("span",{className:"text-xs text-primary-500 font-medium uppercase tracking-wider",children:"最新版本"}),e.jsx(N,{content:`v${r}`,children:e.jsxs(j,{size:"md",color:"primary",variant:"shadow",classNames:{content:"font-mono font-bold text-sm truncate max-w-[120px] sm:max-w-[160px]"},children:["v",r]})})]})]}),a==="updating"&&e.jsxs("div",{className:"flex flex-col items-center justify-center gap-3 py-4 px-4 rounded-lg bg-primary-50/50 dark:bg-primary-900/20 border border-primary-200/50 dark:border-primary-700/30",children:[e.jsx(I,{size:"md",color:"primary"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium text-primary-600 dark:text-primary-400",children:"正在更新中..."}),e.jsx("p",{className:"text-xs text-default-500 mt-1",children:"请耐心等待，更新可能需要几分钟"})]})]}),a==="success"&&e.jsxs("div",{className:"flex flex-col items-center justify-center gap-3 py-4 px-4 rounded-lg bg-success-50/50 dark:bg-success-900/20 border border-success-200/50 dark:border-success-700/30",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-success-100 dark:bg-success-900/40 flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-success-600 dark:text-success-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium text-success-600 dark:text-success-400",children:"更新完成"}),e.jsx("p",{className:"text-xs text-default-500 mt-1",children:"请重启 NapCat 以应用新版本"})]}),e.jsx("div",{className:"mt-2 p-3 rounded-lg bg-warning-50/50 dark:bg-warning-900/20 border border-warning-200/50 dark:border-warning-700/30",children:e.jsxs("p",{className:"text-xs text-warning-700 dark:text-warning-400 flex items-center gap-1 justify-center",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsx("span",{children:"重启 NapCat 生效"})]})}),e.jsx("div",{className:"flex gap-3 justify-center mt-2 w-full",children:e.jsx("button",{className:"px-4 py-2 text-sm rounded-lg bg-primary-500 hover:bg-primary-600 text-white shadow-sm transition-colors shadow-primary-500/20 w-full",onClick:()=>w.restart(),children:"立即重启"})})]}),a==="error"&&e.jsxs("div",{className:"flex flex-col items-center justify-center gap-3 py-4 px-4 rounded-lg bg-danger-50/50 dark:bg-danger-900/20 border border-danger-200/50 dark:border-danger-700/30",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-danger-100 dark:bg-danger-900/40 flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-danger-600 dark:text-danger-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium text-danger-600 dark:text-danger-400",children:"更新失败"}),e.jsx("p",{className:"text-xs text-default-500 mt-1",children:t||"请稍后重试或手动更新"})]})]})]}),Je=s=>{const{currentVersion:r}=s,a=ne(),{data:t,error:i}=_(w.getLatestTag,{cacheKey:"napcat-latest-tag",staleTime:600*1e3,cacheTime:1800*1e3}),[n,c]=m.useState("idle");if(i||!t||!r||!Ke(r,t))return null;const o=async()=>{c("updating");try{await w.UpdateNapCat(),c("success"),a.alert({title:"更新完成",content:e.jsx(R,{currentVersion:r,latestVersion:t,status:"success"}),confirmText:"我知道了",size:"md"})}catch(x){console.error("Update failed:",x);const u=x instanceof Error?x.message:"未知错误";c("error"),a.alert({title:"更新失败",content:e.jsx(R,{currentVersion:r,latestVersion:t,status:"error",errorMessage:u}),confirmText:"确定",size:"md"})}},h=()=>{a.confirm({title:"发现新版本",content:e.jsx(R,{currentVersion:r,latestVersion:t,status:"idle"}),confirmText:"立即更新",cancelText:"稍后更新",size:"md",onConfirm:o})};return e.jsx(N,{content:"有新版本可用",children:e.jsx("div",{className:"cursor-pointer flex items-center justify-center",onClick:n==="updating"?void 0:h,children:e.jsx(j,{size:"sm",color:"danger",variant:"flat",classNames:{content:"font-bold text-[10px] px-1 flex items-center justify-center",base:"h-5 min-h-5 min-w-[42px]"},children:n==="updating"?e.jsx(I,{size:"sm",color:"danger",classNames:{wrapper:"w-3 h-3"}}):"New"})})})},Xe=({currentVersion:s,onClose:r})=>{const a=ne(),[t,i]=m.useState(null),[n,c]=m.useState(!1),[o,h]=m.useState("idle"),[x,u]=m.useState(""),[p,b]=m.useState(1),[g,k]=m.useState("release"),[S,V]=m.useState(""),Q=be(S,300),[v,ie]=m.useState(void 0),[B,H]=m.useState(null),[D,G]=m.useState(!1),[ce,K]=m.useState(!1),oe=async()=>{G(!0);try{const l=await We.testSingleMirror(v||"","file");l.success?H(l.latency):H(null)}catch{H(null)}finally{G(!1)}},de=l=>l>=5e3?">5s":l>=1e3?`${(l/1e3).toFixed(1)}s`:`${l}ms`,me=l=>l===null?"default":l<300?"success":l<1e3?"warning":"danger",xe=()=>{if(!v)return"自动选择";try{return new URL(v).hostname}catch{return v}},he=15,{data:f,loading:ue,error:J}=_(()=>w.getAllReleases({page:p,pageSize:he,type:g,search:Q,mirror:v}),{refreshDeps:[p,g,Q,v]}),E=(f==null?void 0:f.versions)||[],X=m.useCallback(l=>!s||!l||l.startsWith("action-")?!1:le(l,s)<0,[s]),L=(t==null?void 0:t.tag)||"",T=X(L),Y=async l=>{if(t){h("updating"),u("");try{await w.UpdateNapCatToVersion(L,l,v),h("success")}catch(y){console.error("Update failed:",y);const $=y instanceof Error?y.message:"未知错误";u($),h("error")}}},fe=async()=>{if(t){if(T&&!n){a.confirm({title:"确认降级",content:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-warning-600",children:["您正在尝试从 ",e.jsxs("strong",{children:["v",s]})," 降级到 ",e.jsx("strong",{children:L})]}),e.jsx("p",{className:"text-sm text-default-500",children:"降级可能导致配置不兼容或功能丢失，请确认您了解相关风险。"})]}),confirmText:"确认降级",cancelText:"取消",onConfirm:()=>Y(!0)});return}await Y(n)}},pe=l=>{b(l)};if(o==="success")return e.jsxs("div",{className:"flex flex-col items-center justify-center gap-3 py-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-success-100 dark:bg-success-900/40 flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-success-600 dark:text-success-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsxs("div",{className:"text-center w-full",children:[e.jsxs("p",{className:"text-sm font-medium text-success-600 dark:text-success-400",children:["更新到 ",L," 完成"]}),e.jsx("p",{className:"text-xs text-default-500 mt-1 mb-6",children:"请重启 NapCat 以应用新版本"}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx("button",{className:"px-4 py-2 text-sm rounded-lg bg-default-100 hover:bg-default-200 transition-colors text-default-700",onClick:r,children:"稍后重启"}),e.jsx("button",{className:"px-4 py-2 text-sm rounded-lg bg-primary-500 hover:bg-primary-600 text-white shadow-sm transition-colors shadow-primary-500/20",onClick:async()=>{await w.restart(),r()},children:"立即重启"})]})]})]});if(o==="error")return e.jsxs("div",{className:"flex flex-col items-center justify-center gap-3 py-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-danger-100 dark:bg-danger-900/40 flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-danger-600 dark:text-danger-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium text-danger-600 dark:text-danger-400",children:"更新失败"}),e.jsx("p",{className:"text-xs text-default-500 mt-1",children:x||"请稍后重试"})]})]});if(o==="updating")return e.jsxs("div",{className:"flex flex-col items-center justify-center gap-3 py-6",children:[e.jsx(I,{size:"lg",color:"primary"}),e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-sm font-medium text-primary-600 dark:text-primary-400",children:["正在更新到 ",L,"..."]}),e.jsx("p",{className:"text-xs text-default-500 mt-1",children:"请耐心等待，更新可能需要几分钟"})]})]});const O=f==null?void 0:f.pagination;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-default-600",children:"当前版本:"}),e.jsxs(j,{color:"primary",variant:"flat",size:"sm",children:["v",s]})]}),(f==null?void 0:f.mirror)&&e.jsxs("div",{className:"text-xs text-default-400 flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-success-500"}),"镜像: ",f.mirror]})]}),e.jsxs(Qe,{selectedKey:g,onSelectionChange:l=>{k(l),b(1),i(null),V("")},size:"sm",color:"primary",variant:"underlined",classNames:{tabList:"gap-4"},children:[e.jsx(ee,{title:"正式版本"},"release"),e.jsx(ee,{title:"临时版本 (Action)"},"action")]}),e.jsx(q,{className:"bg-default-100/50 shadow-sm",children:e.jsx(M,{className:"py-2 px-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-default-500",children:"镜像源:"}),e.jsx("span",{className:"text-sm font-medium",children:xe()}),B!==null&&e.jsx(j,{size:"sm",color:me(B),variant:"flat",startContent:e.jsx(ye,{size:12}),children:de(B)}),B===null&&!D&&e.jsx(j,{size:"sm",color:"default",variant:"flat",children:"未测试"}),D&&e.jsx(j,{size:"sm",color:"primary",variant:"flat",children:"测速中..."})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(N,{content:"测速",children:e.jsx(A,{isIconOnly:!0,size:"sm",variant:"light",onPress:oe,isLoading:D,children:e.jsx(ze,{size:16})})}),e.jsx(N,{content:"切换镜像",children:e.jsx(A,{isIconOnly:!0,size:"sm",variant:"light",onPress:()=>K(!0),children:e.jsx(Ce,{size:16})})})]})]})})}),e.jsx(Be,{placeholder:"搜索版本号...",size:"sm",value:S,onValueChange:l=>{V(l),b(1),i(null)},startContent:e.jsx(qe,{className:"text-default-400"}),isClearable:!0,onClear:()=>V(""),classNames:{inputWrapper:"h-9"}}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium text-default-700",children:"选择目标版本"}),(f==null?void 0:f.pagination)&&e.jsxs("span",{className:"text-xs text-default-400",children:["共 ",f.pagination.total," 个版本"]})]}),ue?e.jsxs("div",{className:"flex items-center gap-2 py-2",children:[e.jsx(I,{size:"sm"}),e.jsx("span",{className:"text-sm text-default-500",children:"加载版本列表..."})]}):J?e.jsxs("div",{className:"text-sm text-danger-500",children:["加载版本列表失败: ",J.message]}):E.length===0?e.jsx("div",{className:"text-sm text-default-500 py-4 text-center",children:S?`未找到匹配 "${S}" 的版本`:"暂无可用版本"}):e.jsx(Ue,{label:"选择版本",placeholder:"请选择要更新的版本",selectedKeys:t?[L]:[],onSelectionChange:l=>{const y=Array.from(l)[0],$=E.find(ge=>ge.tag===y);i($||null)},classNames:{trigger:"h-auto min-h-10"},children:E.map(l=>{const y=l.tag.replace(/^v/,"")===s,$=X(l.tag);return e.jsx(Ve,{textValue:l.tag,children:e.jsxs("div",{className:"flex flex-col gap-0.5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"truncate max-w-[300px]",children:l.type==="action"&&(l.workflowTitle||l.artifactName)||l.tag}),l.type==="prerelease"&&e.jsx(j,{size:"sm",color:"secondary",variant:"flat",children:"预发布"}),l.type==="action"&&e.jsx(j,{size:"sm",color:"default",variant:"flat",children:"临时"}),y&&e.jsx(j,{size:"sm",color:"success",variant:"flat",children:"当前"}),$&&!y&&l.type!=="action"&&e.jsx(j,{size:"sm",color:"warning",variant:"flat",children:"降级"})]}),l.type==="action"&&e.jsxs("div",{className:"text-xs text-default-400 flex items-center gap-2",children:[e.jsx("span",{className:"font-mono bg-default-100 dark:bg-default-100/10 px-1 rounded",children:l.tag}),l.headSha&&e.jsx("span",{className:"font-mono",title:l.headSha,children:l.headSha.slice(0,7)}),l.createdAt&&e.jsx("span",{children:new Date(l.createdAt).toLocaleString()}),l.size&&e.jsxs("span",{children:[(l.size/1024/1024).toFixed(1)," MB"]})]})]})},l.tag)})})]}),g==="action"&&e.jsx("div",{className:"p-3 rounded-lg bg-default-50 dark:bg-default-100/10 border border-default-200/50",children:e.jsxs("p",{className:"text-xs text-default-500",children:["临时版本来自 GitHub Actions 构建，可能不稳定，适合测试新功能。",(t==null?void 0:t.expiresAt)&&e.jsxs("span",{className:"block mt-1 text-warning-600",children:["此版本将于 ",new Date(t.expiresAt).toLocaleDateString()," 过期"]})]})}),t&&T&&e.jsxs("div",{className:"p-3 rounded-lg bg-warning-50/50 dark:bg-warning-900/20 border border-warning-200/50 dark:border-warning-700/30",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-warning-600 dark:text-warning-400 flex-shrink-0 mt-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-warning-700 dark:text-warning-400",children:"版本降级警告"}),e.jsx("p",{className:"text-xs text-warning-600/80 dark:text-warning-500 mt-1",children:"降级到旧版本可能导致配置不兼容或功能丢失"})]})]}),e.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[e.jsx(Te,{size:"sm",isSelected:n,onValueChange:c}),e.jsx("span",{className:"text-xs text-warning-700 dark:text-warning-400",children:"我了解风险，确认降级"})]})]}),O&&O.totalPages>1&&e.jsx("div",{className:"flex justify-center",children:e.jsx($e,{total:O.totalPages,page:p,onChange:pe,size:"sm",showControls:!0})}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4 border-t border-default-100 dark:border-default-100/10",children:[e.jsx("button",{className:"px-4 py-2 text-sm rounded-lg bg-default-100 hover:bg-default-200 transition-colors",onClick:r,children:"关闭"}),e.jsx("button",{className:d("px-4 py-2 text-sm rounded-lg transition-colors text-white shadow-sm",t&&(!T||n)?"bg-primary-500 hover:bg-primary-600 shadow-primary-500/20":"bg-default-300 cursor-not-allowed"),disabled:!t||T&&!n,onClick:fe,children:T?"确认降级更新":"更新到此版本"})]}),e.jsx(Ae,{isOpen:ce,onClose:()=>K(!1),currentMirror:v,onSelect:l=>{ie(l||void 0),H(null)},type:"file"})]})},Ye=({hasBackground:s=!1})=>{const[r,a]=m.useState(!1),{data:t,loading:i,error:n}=_(w.GetNapCatVersion,{cacheKey:"napcat-version",staleTime:3600*1e3,cacheTime:1440*60*1e3}),c=t==null?void 0:t.version,o=m.useCallback(()=>{c&&a(!0)},[c]);return e.jsxs(e.Fragment,{children:[e.jsx(F,{title:"NapCat 版本",icon:e.jsx(Ie,{className:"text-xl"}),hasBackground:s,value:n?`错误：${n.message}`:i?e.jsx(I,{size:"sm"}):e.jsx(N,{content:"点击管理版本",children:e.jsx("span",{className:"cursor-pointer hover:text-primary-500 transition-colors underline decoration-dashed underline-offset-2",onClick:o,children:c})}),endContent:e.jsx(Je,{currentVersion:c})}),r&&e.jsx(we,{title:"版本管理",size:"lg",hideFooter:!0,onClose:()=>a(!1),content:e.jsx(Xe,{currentVersion:c||"",onClose:()=>a(!1)})})]})},es=s=>{const{archInfo:r}=s,{data:a,loading:t,error:i}=_(w.getQQVersion,{cacheKey:"qq-version",staleTime:3600*1e3,cacheTime:1440*60*1e3}),[n]=C(U.backgroundImage,""),c=!!n;return e.jsxs(q,{className:d("backdrop-blur-sm border border-white/40 dark:border-white/10 shadow-sm overflow-visible flex-1",c?"bg-white/10 dark:bg-black/10":"bg-white/60 dark:bg-black/40"),children:[e.jsxs(je,{className:d("pb-0 items-center gap-2 font-bold px-4 pt-4",c?"text-white drop-shadow-sm":"text-default-700 dark:text-white"),children:[e.jsx(He,{className:"text-lg opacity-80"}),e.jsx("span",{children:"系统信息"})]}),e.jsx(M,{className:"flex-1",children:e.jsxs("div",{className:"flex flex-col gap-2 justify-between h-full",children:[e.jsx(Ye,{hasBackground:c}),e.jsx(F,{title:"QQ 版本",icon:e.jsx(Fe,{className:"text-lg"}),hasBackground:c,value:i?`错误：${i.message}`:t?e.jsx(I,{size:"sm"}):a}),e.jsx(F,{title:"WebUI 版本",icon:e.jsx(Le,{className:"text-xl"}),value:"Next",hasBackground:c}),e.jsx(F,{title:"系统版本",icon:e.jsx(Ze,{className:"text-xl"}),value:r,hasBackground:c})]})})]})};function ss(s){return ae({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M151 22v32h18V22h-18zm48 0v32h18V22h-18zm48 0v32h18V22h-18zm48 0v32h18V22h-18zm48 0v32h18V22h-18zM131.7 73L73 131.7v248.6l58.7 58.7h248.6l58.7-58.7V131.7L380.3 73H131.7zm60.3 46h128v18H192v-18zM22 151v18h32v-18H22zm436 0v18h32v-18h-32zm-339 32h274v146H119V183zm-97 16v18h32v-18H22zm436 0v18h32v-18h-32zm-321 2v110h238V201H137zM22 247v18h32v-18H22zm436 0v18h32v-18h-32zM22 295v18h32v-18H22zm436 0v18h32v-18h-32zM22 343v18h32v-18H22zm436 0v18h32v-18h-32zm-266 32h128v18H192v-18zm-41 83v32h18v-32h-18zm48 0v32h18v-32h-18zm48 0v32h18v-32h-18zm48 0v32h18v-32h-18zm48 0v32h18v-32h-18z"},child:[]}]})(s)}const ts="/webui/assets/1AD934174C0107F14BAD8776D29C5F90-AKhWf6dl.png",se=({systemUsage:s,processUsage:r,title:a,hasBackground:t})=>{const{theme:i}=Ne(),n=Math.max(s||0,0),c=Math.max(r||0,0),o=Math.min(Math.max(n,c),100),h=Math.min(c,o),x=100,u=10,p=(x-u)/2,b=2*Math.PI*p,g=x/2,k={qq:"#D33FF0",other:i==="dark"?"#EF8664":"#EA7D9B",track:i==="dark"?"rgba(255,255,255,0.08)":"rgba(0,0,0,0.05)"},S=m.useMemo(()=>`${o/100*b} ${b}`,[o,b]),V=m.useMemo(()=>`${h/100*b} ${b}`,[h,b]),Q=Math.max(o-h,0),v=e.jsxs("div",{className:"flex flex-col gap-1 p-1 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full",style:{backgroundColor:k.qq}}),e.jsxs("span",{children:["QQ进程: ",h.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full",style:{backgroundColor:k.other}}),e.jsxs("span",{children:["其他进程: ",Q.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full",style:{backgroundColor:k.track}}),e.jsxs("span",{children:["空闲: ",(100-o).toFixed(1),"%"]})]})]});return e.jsx(N,{content:v,placement:"top",children:e.jsxs("div",{className:"relative w-36 h-36 flex items-center justify-center cursor-pointer",children:[e.jsxs("svg",{className:"w-full h-full -rotate-90",viewBox:`0 0 ${x} ${x}`,children:[e.jsx("circle",{cx:g,cy:g,r:p,fill:"none",stroke:k.track,strokeWidth:u,strokeLinecap:"round"}),e.jsx("circle",{cx:g,cy:g,r:p,fill:"none",stroke:k.other,strokeWidth:u,strokeLinecap:"round",strokeDasharray:S,className:"transition-all duration-700 ease-out"}),e.jsx("circle",{cx:g,cy:g,r:p,fill:"none",stroke:k.qq,strokeWidth:u,strokeLinecap:"round",strokeDasharray:V,className:"transition-all duration-700 ease-out"})]}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center pointer-events-none select-none",children:[a&&e.jsx("span",{className:d("text-[10px] font-medium mb-0.5 opacity-80 uppercase tracking-widest scale-90",t?"text-white/80":"text-default-500 dark:text-default-400"),children:a}),e.jsxs("div",{className:"flex items-baseline gap-0.5",children:[e.jsx("span",{className:d("text-2xl font-bold font-mono tracking-tight",t?"text-white":"text-default-900 dark:text-white"),children:Math.round(o)}),e.jsx("span",{className:d("text-xs font-bold",t?"text-white/60":"text-default-400 dark:text-default-500"),children:"%"})]})]})]})})},z=({title:s,value:r="-",size:a="md",unit:t,hasBackground:i=!1})=>e.jsxs("div",{className:d("py-1.5 text-sm transition-colors",a==="lg"?"col-span-2":"col-span-1 flex justify-between items-center"),children:[e.jsx("div",{className:d("w-24 font-medium",i?"text-white/90":"text-default-600 dark:text-gray-300"),children:s}),e.jsxs("div",{className:d("font-mono text-xs",i?"text-white/80":"text-default-500"),children:[r,t&&e.jsx("span",{className:"ml-0.5 opacity-70",children:t})]})]}),rs=({data:s})=>{const r={system:0,qq:0};if(s){const i=Number(s.memory.total)||1,n=Number(s.memory.usage.system),c=Number(s.memory.usage.qq);r.system=n/i*100,r.qq=c/i*100}const[a]=C(U.backgroundImage,""),t=!!a;return e.jsxs(q,{className:d("backdrop-blur-sm border border-white/40 dark:border-white/10 shadow-sm col-span-1 lg:col-span-2 relative overflow-hidden",t?"bg-white/10 dark:bg-black/10":"bg-white/60 dark:bg-black/40"),children:[e.jsx("div",{className:"absolute h-full right-0 top-0",children:e.jsx(re,{src:ts,alt:"background",className:"select-none pointer-events-none !opacity-30 w-full h-full",classNames:{wrapper:"w-full h-full",img:"object-contain w-full h-full"}})}),e.jsxs(M,{className:"overflow-visible md:flex-row gap-4 items-center justify-stretch z-10",children:[e.jsxs("div",{className:"flex-1 w-full md:max-w-96",children:[e.jsxs("h2",{className:d("text-lg font-semibold flex items-center gap-2 mb-2",t?"text-white drop-shadow-sm":"text-default-700 dark:text-gray-200"),children:[e.jsx(ss,{className:"text-xl opacity-80"}),e.jsx("span",{children:"CPU"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(z,{title:"型号",value:s==null?void 0:s.cpu.model,size:"lg",hasBackground:t}),e.jsx(z,{title:"内核数",value:s==null?void 0:s.cpu.core,hasBackground:t}),e.jsx(z,{title:"主频",value:s==null?void 0:s.cpu.speed,unit:"GHz",hasBackground:t}),e.jsx(z,{title:"使用率",value:s==null?void 0:s.cpu.usage.system,unit:"%",hasBackground:t}),e.jsx(z,{title:"QQ主线程",value:s==null?void 0:s.cpu.usage.qq,unit:"%",hasBackground:t})]}),e.jsxs("h2",{className:d("text-lg font-semibold flex items-center gap-2 mb-2 mt-4",t?"text-white drop-shadow-sm":"text-default-700 dark:text-gray-200"),children:[e.jsx(Pe,{className:"text-xl opacity-80"}),e.jsx("span",{children:"内存"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(z,{title:"总量",value:s==null?void 0:s.memory.total,size:"lg",unit:"MB",hasBackground:t}),e.jsx(z,{title:"使用量",value:s==null?void 0:s.memory.usage.system,unit:"MB",hasBackground:t}),e.jsx(z,{title:"QQ主线程",value:s==null?void 0:s.memory.usage.qq,unit:"MB",hasBackground:t})]})]}),e.jsxs("div",{className:"flex flex-row md:flex-col gap-2 flex-shrink-0 w-full justify-center md:w-40 min-h-40 mt-4 md:mt-0 md:mx-auto",children:[e.jsx(se,{systemUsage:Number(s==null?void 0:s.cpu.usage.system)||0,processUsage:Number(s==null?void 0:s.cpu.usage.qq)||0,title:"CPU占用",hasBackground:t}),e.jsx(se,{systemUsage:r.system,processUsage:r.qq,title:"内存占用",hasBackground:t})]})]})]})},as=()=>{const{config:s,refreshConfig:r}=De(),a=s.network.httpClients.length+s.network.websocketClients.length+s.network.websocketServers.length+s.network.httpServers.length;return m.useEffect(()=>{r()},[]),e.jsxs("div",{className:"grid grid-cols-8 md:grid-cols-3 lg:grid-cols-6 gap-y-2 gap-x-1 md:gap-y-4 md:gap-x-4 py-5",children:[e.jsx(P,{count:a,label:"网络配置"}),e.jsx(P,{count:s.network.httpServers.length,label:"HTTP服务器",size:"sm"}),e.jsx(P,{count:s.network.httpClients.length,label:"HTTP客户端",size:"sm"}),e.jsx(P,{count:s.network.websocketServers.length,label:"WS服务器",size:"sm"}),e.jsx(P,{count:s.network.websocketClients.length,label:"WS客户端",size:"sm"})]})},ns=()=>{const{data:s,loading:r,error:a}=_(Ee.getQQLoginInfo);return e.jsx(Re,{data:s,error:a,loading:r})},ls=({setArchInfo:s})=>{const[r,a]=C("napcat_system_status_cache",void 0),t=m.useRef(!1),i=m.useCallback(()=>{try{return w.getSystemStatus(a)}catch{Z.error("获取系统状态失败")}},[]);return m.useEffect(()=>{const n=i();return()=>{n==null||n.close()}},[i]),m.useEffect(()=>{r!=null&&r.arch&&!t.current&&(s(r.arch),t.current=!0)},[r,s]),e.jsx(rs,{data:r})},Qs=()=>{const[s,r]=C("napcat_arch_info_cache",void 0),[a]=C(U.backgroundImage,""),t=!!a;return e.jsxs(e.Fragment,{children:[e.jsx("title",{children:"基础信息 - NapCat WebUI"}),e.jsxs("section",{className:"w-full p-2 md:p-4 md:max-w-[1000px] mx-auto overflow-hidden",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 items-stretch",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(ns,{}),e.jsx(es,{archInfo:s})]}),e.jsx(ls,{setArchInfo:r})]}),e.jsx(as,{}),e.jsx(q,{className:d("backdrop-blur-sm border border-white/40 dark:border-white/10 shadow-sm transition-all overflow-hidden",t?"bg-white/10 dark:bg-black/10":"bg-white/60 dark:bg-black/40"),children:e.jsx(M,{className:"overflow-hidden",children:e.jsx(Oe,{})})})]})]})};export{Qs as default};
