import{j as r,h as w,r as ve,g as nr}from"./codemirror-core-DIzFijqu.js";import{b as P,A as ar,q as sr,v as cr,x as or,y as ir,z as ur,k as we}from"./index-B0DyBq9P.js";import{b as Qe,c as lr,a as Ye}from"./chunk-5PILOUBS-C2iqzQ1E.js";import{i as Ne}from"./chunk-2QAN2V2R-DjiYH11d.js";import{c as q,C as dr,aj as fr,J as Q,ak as vr,u as Oe}from"./react-dom-TsCL3mk_.js";import{m as hr,b as pr,n as mr,o as br}from"./index-CtZU_f5P.js";import{p as he,a as pe,b as me}from"./chunk-2QQAR2RD-C6SUFd_i.js";import{g as gr,a as _r,i as ke,O as T,b as Sr,c as jr,d as yr,s as Ke,e as xr,f as ne,C as Er,h as wr}from"./modal-CZlb9vmt.js";import{c as A}from"./chunk-NAV3ZXLI-VwA3667I.js";import{a as fe}from"./chunk-SXMLSBOY-CAmQOhGG.js";import{i as Te}from"./chunk-MLPFQTYO-6EVO19Sj.js";import{q as Nr}from"./qface-CqvgXw72.js";import{c as Or}from"./index-DhICtZLt.js";import{C as kr}from"./code_editor--lSn7AvI.js";import{s as Tr,l as Cr}from"./chunk-KVDW62ZT-CdlHxaox.js";import"./chunk-CAFRINWI-CcU5yOMx.js";import"./chunk-SLABUSGS-BX9EgnNv.js";import"./chunk-M3MASYO7-BtOvSeRL.js";import"./iconBase-ClXMXqAg.js";import"./chunk-WQVQ7P2I-B4KcTpLM.js";import"./chunk-FGM523TA-1yNCP0SW.js";import"./_baseIsEqual-DpqT7ENi.js";import"./chunk-6LIX6LVT-v4ufXNaW.js";import"./use-dialog-CRavAmtS.js";import"./index-DYKlz1bo.js";import"./index-3atF2w48.js";import"./index-CZV_7wPI.js";import"./chunk-ML27DD5T-CMfbU3IH.js";import"./index-CokAva9Y.js";import"./Item-DvdRZmps.js";import"./react-hook-form-D03iFOdR.js";import"./codemirror-lang-9foHeFXi.js";import"./chunk-AXSF7SRE-xAGcR_TS.js";const Ir=({data:e})=>r.jsxs("div",{className:"flex gap-2",children:[r.jsx(A,{children:"心跳"}),r.jsxs(A,{children:["间隔 ",e.status.interval,"ms"]})]}),Dr=({data:e})=>r.jsxs("div",{className:"flex gap-2",children:[r.jsx(A,{children:"生命周期"}),r.jsx(A,{color:_r(e.sub_type),children:gr(e.sub_type)})]}),Mr=({data:e})=>r.jsxs("div",{className:"h-full flex items-center",children:[e.meta_event_type==="lifecycle"&&r.jsx(Dr,{data:e}),e.meta_event_type==="heartbeat"&&r.jsx(Ir,{data:e})]}),X=e=>e.toString().padStart(2,"0"),Ar=e=>{e=e*1e3;const o=new Date(e),c=o.getFullYear(),t=o.getMonth()+1,u=o.getDate(),v=o.getHours(),b=o.getMinutes(),g=o.getSeconds();return`${c}-${X(t)}-${X(u)} ${X(v)}:${X(b)}:${X(g)}`},Ce=(e,o=!1)=>e.map((c,t)=>{switch(c.type){case"text":return r.jsx("span",{children:c.data.text},t);case"face":return r.jsx(Te,{removeWrapper:!0,classNames:{img:"w-6 h-6 inline !text-[0px] m-0 -mt-1.5 !p-0"},src:Nr.getUrl(c.data.id),alt:`face-${c.data.id}`},t);case"image":return r.jsx(Te,{classNames:{wrapper:"block !text-[0px] !m-0 !p-0",img:"block"},radius:"sm",className:o?"max-h-16 object-cover":"max-w-64 max-h-96 h-auto object-cover",src:c.data.url||c.data.file,alt:"image",referrerPolicy:"no-referrer"},t);case"record":return r.jsx("audio",{controls:!0,src:c.data.url||c.data.file},t);case"video":return r.jsx("video",{controls:!0,src:c.data.url||c.data.file},t);case"at":return r.jsxs("span",{className:"text-blue-500",children:["@",c.data.qq==="all"?"所有人":r.jsxs("span",{children:[c.data.name,"(",c.data.qq,")"]})]},t);case"rps":return r.jsx("span",{children:"[猜拳]"},t);case"dice":return r.jsx("span",{children:"[掷骰子]"},t);case"shake":return r.jsx("span",{children:"[窗口抖动]"},t);case"poke":return r.jsxs("span",{children:["[戳一戳: ",c.data.name||c.data.id,"]"]},t);case"anonymous":return r.jsx("span",{children:"[匿名消息]"},t);case"share":return r.jsx("a",{href:c.data.url,target:"_blank",rel:"noopener noreferrer",children:c.data.title},t);case"contact":return r.jsxs("span",{children:["[推荐",c.data.type==="qq"?"好友":"群",": ",c.data.id,"]"]},t);case"location":return r.jsxs("span",{children:["[位置: ",c.data.title||"未知","]"]},t);case"music":return c.data.type==="custom"?r.jsx("a",{href:c.data.url,target:"_blank",rel:"noopener noreferrer",children:c.data.title},t):r.jsxs("span",{children:["[音乐: ",c.data.type," - ",c.data.id,"]"]},t);case"reply":return r.jsxs("div",{className:"bg-content3 py-1 px-2 rounded-md flex items-center gap-1",children:[r.jsx(Or,{className:"text-default-500"}),"回复消息ID: ",c.data.id]},t);case"forward":return r.jsxs("span",{children:["[合并转发: ",c.data.id,"]"]},t);case"node":return r.jsx("span",{children:"[消息节点]"},t);case"xml":return r.jsx("pre",{children:c.data.data},t);case"json":return r.jsx("pre",{className:"break-all whitespace-break-spaces",children:c.data.data},t);case"file":return r.jsx("a",{href:c.data.file,target:"_blank",rel:"noopener noreferrer",children:"[文件]"},t);default:return r.jsx("span",{children:"[不支持的消息类型]"},t)}}),Xe=({data:e})=>r.jsxs("div",{className:"h-full flex flex-col overflow-hidden flex-1",children:[r.jsxs("div",{className:"flex gap-2 items-center flex-shrink-0",children:[r.jsxs("div",{className:"font-bold",children:[ke(e)&&e.sender.card&&r.jsx("span",{className:"mr-1",children:e.sender.card}),r.jsx("span",{className:q(ke(e)&&e.sender.card&&"text-default-400 font-normal"),children:e.sender.nickname})]}),r.jsxs("div",{children:["(",e.sender.user_id,")"]}),r.jsxs("div",{className:"text-sm",children:["消息ID: ",e.message_id]})]}),r.jsxs(he,{showArrow:!0,triggerScaleOnOpen:!1,children:[r.jsx(pe,{children:r.jsxs("div",{className:"flex-1 break-all overflow-hidden whitespace-pre-wrap border border-default-100 p-2 rounded-md hover:bg-content2 md:cursor-pointer transition-background relative group",children:[r.jsx("div",{className:"absolute right-2 top-2 opacity-0 group-hover:opacity-100 text-default-300",children:"点击查看完整消息"}),Array.isArray(e.message)?Ce(e.message,!0):e.raw_message]})}),r.jsx(me,{children:r.jsx("div",{className:"p-2",children:Array.isArray(e.message)?Ce(e.message):e.raw_message})})]})]}),Pr=({data:e})=>r.jsxs("div",{className:"h-full overflow-hidden flex flex-col w-full",children:[r.jsxs("div",{className:"flex items-center p-1 flex-shrink-0",children:[r.jsx(fe,{src:`https://p.qlogo.cn/gh/${e.group_id}/${e.group_id}/0/`,alt:"群头像",size:"sm",className:"flex-shrink-0 mr-2"}),r.jsxs("div",{children:["群 ",e.group_id]})]}),r.jsxs("div",{className:"flex items-start p-1 rounded-md h-full flex-1 border border-default-100",children:[r.jsx(fe,{src:`https://q1.qlogo.cn/g?b=qq&nk=${e.sender.user_id}&s=100`,alt:"用户头像",size:"md",className:"flex-shrink-0 mr-2"}),r.jsx(Xe,{data:e})]})]}),Lr=({data:e})=>r.jsxs("div",{className:"flex items-start p-2 rounded-md h-full flex-1",children:[r.jsx(fe,{src:`https://q1.qlogo.cn/g?b=qq&nk=${e.sender.user_id}&s=100`,alt:"用户头像",size:"md",className:"flex-shrink-0 mr-2"}),r.jsx(Xe,{data:e})]}),Ie=({data:e})=>e.message_type==="group"?r.jsx(Pr,{data:e}):e.message_type==="private"?r.jsx(Lr,{data:e}):r.jsx("div",{children:"未知消息类型"}),Rr=({data:e})=>{const{group_id:o,user_id:c,file:t}=e;return r.jsxs(r.Fragment,{children:[r.jsxs("div",{children:["群号: ",o]}),r.jsxs("div",{children:["用户ID: ",c]}),r.jsxs("div",{children:["文件名: ",t.name]}),r.jsxs("div",{children:["文件大小: ",t.size," 字节"]})]})},Wr=({data:e})=>{const{group_id:o,user_id:c,sub_type:t}=e;return r.jsxs(r.Fragment,{children:[r.jsxs("div",{children:["群号: ",o]}),r.jsxs("div",{children:["用户ID: ",c]}),r.jsxs("div",{children:["变动类型: ",t==="set"?"设置管理员":"取消管理员"]})]})},Ur=({data:e})=>{const{group_id:o,operator_id:c,user_id:t,sub_type:u}=e;return r.jsxs(r.Fragment,{children:[r.jsxs("div",{children:["群号: ",o]}),r.jsxs("div",{children:["操作者ID: ",c]}),r.jsxs("div",{children:["用户ID: ",t]}),r.jsxs("div",{children:["原因: ",u]})]})},qr=({data:e})=>{const{group_id:o,operator_id:c,user_id:t,sub_type:u}=e;return r.jsxs(r.Fragment,{children:[r.jsxs("div",{children:["群号: ",o]}),r.jsxs("div",{children:["操作者ID: ",c]}),r.jsxs("div",{children:["用户ID: ",t]}),r.jsxs("div",{children:["增加类型: ",u]})]})},Fr=({data:e})=>{const{group_id:o,operator_id:c,user_id:t,sub_type:u,duration:v}=e;return r.jsxs(r.Fragment,{children:[r.jsxs("div",{children:["群号: ",o]}),r.jsxs("div",{children:["操作者ID: ",c]}),r.jsxs("div",{children:["用户ID: ",t]}),r.jsxs("div",{children:["禁言类型: ",u]}),r.jsxs("div",{children:["禁言时长: ",v," 秒"]})]})},Gr=({data:e})=>{const{user_id:o}=e;return r.jsx(r.Fragment,{children:r.jsxs("div",{children:["用户ID: ",o]})})},Br=({data:e})=>{const{group_id:o,user_id:c,operator_id:t,message_id:u}=e;return r.jsxs(r.Fragment,{children:[r.jsxs("div",{children:["群号: ",o]}),r.jsxs("div",{children:["用户ID: ",c]}),r.jsxs("div",{children:["操作者ID: ",t]}),r.jsxs("div",{children:["消息ID: ",u]})]})},Hr=({data:e})=>{const{user_id:o,message_id:c}=e;return r.jsxs(r.Fragment,{children:[r.jsxs("div",{children:["用户ID: ",o]}),r.jsxs("div",{children:["消息ID: ",c]})]})},Jr=({data:e})=>{const{group_id:o,user_id:c,target_id:t}=e;return r.jsxs(r.Fragment,{children:[r.jsxs("div",{children:["群号: ",o]}),r.jsxs("div",{children:["用户ID: ",c]}),r.jsxs("div",{children:["目标ID: ",t]})]})},zr=({data:e})=>{const{group_id:o,user_id:c,target_id:t}=e;return r.jsxs(r.Fragment,{children:[r.jsxs("div",{children:["群号: ",o]}),r.jsxs("div",{children:["用户ID: ",c]}),r.jsxs("div",{children:["目标ID: ",t]})]})},Vr=({data:e})=>{const{group_id:o,user_id:c,honor_type:t}=e;return r.jsxs(r.Fragment,{children:[r.jsxs("div",{children:["群号: ",o]}),r.jsxs("div",{children:["用户ID: ",c]}),r.jsxs("div",{children:["荣誉类型: ",t]})]})},Qr=({data:e})=>{const{group_id:o,user_id:c,message_id:t,likes:u}=e;return r.jsxs(r.Fragment,{children:[r.jsxs("div",{children:["群号: ",o]}),r.jsxs("div",{children:["用户ID: ",c]}),r.jsxs("div",{children:["消息ID: ",t]}),r.jsxs("div",{children:["表情回应:",u.map(v=>`表情ID: ${v.emoji_id}, 数量: ${v.count}`).join(", ")]})]})},Yr=({data:e})=>{const{group_id:o,message_id:c,sender_id:t,operator_id:u,sub_type:v}=e;return r.jsxs(r.Fragment,{children:[r.jsxs("div",{children:["群号: ",o]}),r.jsxs("div",{children:["消息ID: ",c]}),r.jsxs("div",{children:["发送者ID: ",t]}),r.jsxs("div",{children:["操作者ID: ",u]}),r.jsxs("div",{children:["操作类型: ",v]})]})},Kr=({data:e})=>{const{group_id:o,user_id:c,card_new:t,card_old:u}=e;return r.jsxs(r.Fragment,{children:[r.jsxs("div",{children:["群号: ",o]}),r.jsxs("div",{children:["用户ID: ",c]}),r.jsxs("div",{children:["新名片: ",t]}),r.jsxs("div",{children:["旧名片: ",u]})]})},Xr=({data:e})=>{let o;switch(e.notice_type){case T.GroupUpload:o=r.jsx(Rr,{data:e});break;case T.GroupAdmin:o=r.jsx(Wr,{data:e});break;case T.GroupDecrease:o=r.jsx(Ur,{data:e});break;case T.GroupIncrease:o=r.jsx(qr,{data:e});break;case T.GroupBan:o=r.jsx(Fr,{data:e});break;case T.FriendAdd:o=r.jsx(Gr,{data:e});break;case T.GroupRecall:o=r.jsx(Br,{data:e});break;case T.FriendRecall:o=r.jsx(Hr,{data:e});break;case T.Notify:switch(e.sub_type){case"poke":o=r.jsx(Jr,{data:e});break;case"lucky_king":o=r.jsx(zr,{data:e});break;case"honor":o=r.jsx(Vr,{data:e});break}break;case T.GroupMsgEmojiLike:o=r.jsx(Qr,{data:e});break;case T.GroupEssence:o=r.jsx(Yr,{data:e});break;case T.GroupCard:o=r.jsx(Kr,{data:e});break}return r.jsxs("div",{className:"flex gap-2 items-center",children:[r.jsx(A,{color:"warning",variant:"flat",children:"通知"}),r.jsx(A,{children:Sr(e.notice_type)}),o]})},Zr=({data:e})=>r.jsxs("div",{className:"flex gap-2 items-center",children:[r.jsx(A,{color:yr(e.status),variant:"flat",children:jr(e.status)}),e.data&&r.jsxs(he,{placement:"right",showArrow:!0,classNames:{content:"max-h-96 max-w-96 overflow-hidden p-0"},children:[r.jsx(pe,{children:r.jsx(P,{size:"sm",color:"primary",variant:"flat",radius:"full",className:"text-medium",children:"查看数据"})}),r.jsx(me,{children:r.jsx(Ke,{hideSymbol:!0,tooltipProps:{content:"点击复制"},classNames:{copyButton:"self-start sticky top-0 right-0"},className:"bg-content1 h-full overflow-y-scroll items-start",children:JSON.stringify(e.data,null,2).split(`
`).map((o,c)=>r.jsx("span",{className:"whitespace-pre-wrap break-all",children:o},c))})})]}),e.message&&r.jsxs(A,{className:"pl-0.5",variant:"flat",children:[r.jsx(A,{color:"warning",size:"sm",className:"-ml-2 mr-1",variant:"flat",children:"返回消息"}),e.message]})]}),$r={hidden:{opacity:0,scale:.8,y:50},visible:{opacity:1,scale:1,y:0,transition:{type:"spring",stiffness:300,damping:20}}};function et({data:e}){return r.jsx("div",{children:"Request消息，暂未适配"})}const rt=e=>e==="meta_event"?100:e==="message"?180:e==="request"||e==="notice"?100:e==="message_sent"?250:100,tt=e=>{if(ne(e))switch(e.post_type){case"meta_event":return r.jsx(Mr,{data:e});case"message":return r.jsx(Ie,{data:e});case"request":return r.jsx(et,{data:e});case"notice":return r.jsx(Xr,{data:e});case"message_sent":return r.jsx(Ie,{data:e});default:return r.jsx("div",{children:"未知类型的消息"})}return r.jsx(Zr,{data:e})},nt=({data:e,index:o,style:c})=>{const t=e[o],u=ne(t);return r.jsx("div",{style:c,className:"p-1 overflow-visible w-full h-full",children:r.jsx(dr.div,{variants:$r,initial:"hidden",animate:"visible",className:"h-full px-2",children:r.jsxs(Qe,{className:"w-full h-full py-2 bg-white/60 dark:bg-black/40 backdrop-blur-xl border border-white/40 dark:border-white/10 shadow-sm",children:[r.jsxs(lr,{className:"py-0 text-default-500 flex-row gap-2",children:[r.jsx("div",{className:"font-bold",children:u?xr(t.post_type):"请求响应"}),r.jsx("div",{className:"text-sm",children:u&&Ar(t.time)}),r.jsx("div",{className:"ml-auto",children:r.jsxs(he,{placement:"left",showArrow:!0,classNames:{content:"max-h-96 max-w-96 overflow-hidden p-0"},children:[r.jsx(pe,{children:r.jsx(P,{size:"sm",color:"primary",variant:"flat",radius:"full",isIconOnly:!0,className:"text-medium",children:r.jsx(hr,{})})}),r.jsx(me,{children:r.jsx(Ke,{hideSymbol:!0,tooltipProps:{content:"点击复制"},classNames:{copyButton:"self-start sticky top-0 right-0"},className:"bg-content1 h-full overflow-y-scroll items-start",children:JSON.stringify(t,null,2).split(`
`).map((v,b)=>r.jsx("span",{className:"whitespace-pre-wrap break-all",children:v},b))})})]})})]}),r.jsx(Ye,{className:"py-0",children:tt(t)})]})})})},at=e=>{const{messages:o}=e,c=w.useRef(null),t=w.useRef(null),[u,v]=w.useState(400);return w.useEffect(()=>{const b=new ResizeObserver(()=>{c.current&&v(c.current.offsetHeight)});return c.current&&b.observe(c.current),()=>{b.disconnect()}},[]),w.useEffect(()=>{t.current&&t.current.resetAfterIndex(0,!0)},[o]),r.jsx("div",{className:"w-full h-full overflow-hidden",ref:c,children:r.jsx(fr,{ref:t,itemCount:o.length,width:"100%",style:{overflowX:"hidden"},itemSize:b=>{const g=o[b];return ne(g)?rt(g.post_type):100},height:u,itemData:o,itemKey:b=>o.length-b-1,children:nt})})},st=e=>{const{sendMessage:o}=e,{isOpen:c,onOpen:t,onOpenChange:u}=ar(),v=w.useRef(null),b=w.useCallback(g=>{var p;const f=(p=v.current)==null?void 0:p.getValue();if(!f){Q.error("消息不能为空");return}try{o(f),Q.success("消息发送成功"),g()}catch{Q.error("消息发送失败")}},[o]);return r.jsxs(r.Fragment,{children:[r.jsx(P,{onPress:t,color:"primary",radius:"full",variant:"flat",size:"sm",className:"font-medium",children:"构造请求"}),r.jsx(sr,{isOpen:c,onOpenChange:u,placement:"top-center",size:"5xl",scrollBehavior:"outside",isDismissable:!1,children:r.jsx(cr,{children:g=>r.jsxs(r.Fragment,{children:[r.jsx(or,{className:"flex flex-col gap-1",children:"构造请求"}),r.jsx(ir,{children:r.jsx("div",{className:"h-96",children:r.jsx(kr,{height:"100%",defaultLanguage:"json",defaultValue:`{
  "action": "get_group_list"
}`,ref:v})})}),r.jsxs(ur,{children:[r.jsx(Er,{}),r.jsx(P,{color:"primary",variant:"flat",onPress:g,children:"取消"}),r.jsx(P,{color:"primary",onPress:()=>b(g),children:"发送"})]})]})})})]})};var oe={},O={},ie={},De;function C(){return De||(De=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.isEventSourceSupported=e.isReactNative=e.ReadyState=e.DEFAULT_HEARTBEAT=e.UNPARSABLE_JSON_OBJECT=e.DEFAULT_RECONNECT_INTERVAL_MS=e.DEFAULT_RECONNECT_LIMIT=e.SOCKET_IO_PING_CODE=e.SOCKET_IO_PATH=e.SOCKET_IO_PING_INTERVAL=e.DEFAULT_EVENT_SOURCE_OPTIONS=e.EMPTY_EVENT_HANDLERS=e.DEFAULT_OPTIONS=void 0;var o=1,c=1e3*o;e.DEFAULT_OPTIONS={},e.EMPTY_EVENT_HANDLERS={},e.DEFAULT_EVENT_SOURCE_OPTIONS={withCredentials:!1,events:e.EMPTY_EVENT_HANDLERS},e.SOCKET_IO_PING_INTERVAL=25*c,e.SOCKET_IO_PATH="/socket.io/?EIO=3&transport=websocket",e.SOCKET_IO_PING_CODE="2",e.DEFAULT_RECONNECT_LIMIT=20,e.DEFAULT_RECONNECT_INTERVAL_MS=5e3,e.UNPARSABLE_JSON_OBJECT={},e.DEFAULT_HEARTBEAT={message:"ping",timeout:6e4,interval:25e3};var t;(function(v){v[v.UNINSTANTIATED=-1]="UNINSTANTIATED",v[v.CONNECTING=0]="CONNECTING",v[v.OPEN=1]="OPEN",v[v.CLOSING=2]="CLOSING",v[v.CLOSED=3]="CLOSED"})(t||(e.ReadyState=t={}));var u=function(){try{return"EventSource"in globalThis}catch{return!1}};e.isReactNative=typeof navigator<"u"&&navigator.product==="ReactNative",e.isEventSourceSupported=!e.isReactNative&&u()})(ie)),ie}var Z={},ue={},Me;function be(){return Me||(Me=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.resetWebSockets=e.sharedWebSockets=void 0,e.sharedWebSockets={};var o=function(c){if(c&&e.sharedWebSockets.hasOwnProperty(c))delete e.sharedWebSockets[c];else for(var t in e.sharedWebSockets)e.sharedWebSockets.hasOwnProperty(t)&&delete e.sharedWebSockets[t]};e.resetWebSockets=o})(ue)),ue}var R={},I={},Ae;function ge(){if(Ae)return I;Ae=1,Object.defineProperty(I,"__esModule",{value:!0}),I.setUpSocketIOPing=I.appendQueryParams=I.parseSocketIOUrl=void 0;var e=C(),o=function(u){if(u){var v=/^https|wss/.test(u),b=u.replace(/^(https?|wss?)(:\/\/)?/,""),g=b.replace(/\/$/,""),f=v?"wss":"ws";return"".concat(f,"://").concat(g).concat(e.SOCKET_IO_PATH)}else if(u===""){var v=/^https/.test(window.location.protocol),f=v?"wss":"ws",p=window.location.port?":".concat(window.location.port):"";return"".concat(f,"://").concat(window.location.hostname).concat(p).concat(e.SOCKET_IO_PATH)}return u};I.parseSocketIOUrl=o;var c=function(u,v){v===void 0&&(v={});var b=/\?([\w]+=[\w]+)/,g=b.test(u),f="".concat(Object.entries(v).reduce(function(p,l){var s=l[0],d=l[1];return p+"".concat(s,"=").concat(d,"&")},"").slice(0,-1));return"".concat(u).concat(g?"&":"?").concat(f)};I.appendQueryParams=c;var t=function(u,v){v===void 0&&(v=e.SOCKET_IO_PING_INTERVAL);var b=function(){return u(e.SOCKET_IO_PING_CODE)};return window.setInterval(b,v)};return I.setUpSocketIOPing=t,I}var re={},Pe;function Ze(){if(Pe)return re;Pe=1,Object.defineProperty(re,"__esModule",{value:!0}),re.heartbeat=c;var e=C();function o(t){return Array.isArray(t)?t.reduce(function(u,v){return u.current>v.current?u:v}).current:t.current}function c(t,u,v){var b=v||{},g=b.interval,f=g===void 0?e.DEFAULT_HEARTBEAT.interval:g,p=b.timeout,l=p===void 0?e.DEFAULT_HEARTBEAT.timeout:p,s=b.message,d=s===void 0?e.DEFAULT_HEARTBEAT.message:s,n=Math.max(100,f/10),a=Date.now(),h=setInterval(function(){var m=Date.now(),i=o(u);if(i+l<=m)console.warn("Heartbeat timed out, closing connection, last message received ".concat(m-i,"ms ago, last ping sent ").concat(m-a,"ms ago")),t.close();else if(i+f<=m&&a+f<=m)try{typeof d=="function"?t.send(d()):t.send(d),a=m}catch(_){console.error("Heartbeat failed, closing connection",_ instanceof Error?_.message:_),t.close()}},n);return t.addEventListener("close",function(){clearInterval(h)}),function(){}}return re}var $={},le={},Le;function _e(){return Le||(Le=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.resetSubscribers=e.removeSubscriber=e.addSubscriber=e.hasSubscribers=e.getSubscribers=void 0;var o={},c=[],t=function(f){return(0,e.hasSubscribers)(f)?Array.from(o[f]):c};e.getSubscribers=t;var u=function(f){var p;return((p=o[f])===null||p===void 0?void 0:p.size)>0};e.hasSubscribers=u;var v=function(f,p){o[f]=o[f]||new Set,o[f].add(p)};e.addSubscriber=v;var b=function(f,p){o[f].delete(p)};e.removeSubscriber=b;var g=function(f){if(f&&o.hasOwnProperty(f))delete o[f];else for(var p in o)o.hasOwnProperty(p)&&delete o[p]};e.resetSubscribers=g})(le)),le}var Re;function Se(){if(Re)return $;Re=1,Object.defineProperty($,"__esModule",{value:!0}),$.assertIsWebSocket=c,$.resetGlobalState=t;var e=be(),o=_e();function c(u,v){if(!v&&!(u instanceof WebSocket))throw new Error("")}function t(u){(0,o.resetSubscribers)(u),(0,e.resetWebSockets)(u)}return $}var We;function ct(){if(We)return R;We=1;var e=R&&R.__assign||function(){return e=Object.assign||function(l){for(var s,d=1,n=arguments.length;d<n;d++){s=arguments[d];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(l[a]=s[a])}return l},e.apply(this,arguments)};Object.defineProperty(R,"__esModule",{value:!0}),R.attachListeners=void 0;var o=ge(),c=Ze(),t=C(),u=Se(),v=function(l,s,d,n){l.onmessage=function(a){var h;s.current.onMessage&&s.current.onMessage(a),typeof(n==null?void 0:n.current)=="number"&&(n.current=Date.now()),!(typeof s.current.filter=="function"&&s.current.filter(a)!==!0)&&(s.current.heartbeat&&typeof s.current.heartbeat!="boolean"&&((h=s.current.heartbeat)===null||h===void 0?void 0:h.returnMessage)===a.data||d(a))}},b=function(l,s,d,n,a){l.onopen=function(h){if(s.current.onOpen&&s.current.onOpen(h),n.current=0,d(t.ReadyState.OPEN),s.current.heartbeat&&l instanceof WebSocket){var m=typeof s.current.heartbeat=="boolean"?void 0:s.current.heartbeat;a.current=Date.now(),(0,c.heartbeat)(l,a,m)}}},g=function(l,s,d,n,a){if(t.isEventSourceSupported&&l instanceof EventSource)return function(){};(0,u.assertIsWebSocket)(l,s.current.skipAssert);var h;return l.onclose=function(m){var i;if(s.current.onClose&&s.current.onClose(m),d(t.ReadyState.CLOSED),s.current.shouldReconnect&&s.current.shouldReconnect(m)){var _=(i=s.current.reconnectAttempts)!==null&&i!==void 0?i:t.DEFAULT_RECONNECT_LIMIT;if(a.current<_){var x=typeof s.current.reconnectInterval=="function"?s.current.reconnectInterval(a.current):s.current.reconnectInterval;h=window.setTimeout(function(){a.current++,n()},x??t.DEFAULT_RECONNECT_INTERVAL_MS)}else s.current.onReconnectStop&&s.current.onReconnectStop(_),console.warn("Max reconnect attempts of ".concat(_," exceeded"))}},function(){return h&&window.clearTimeout(h)}},f=function(l,s,d,n,a){var h;return l.onerror=function(m){var i;if(s.current.onError&&s.current.onError(m),t.isEventSourceSupported&&l instanceof EventSource&&(s.current.onClose&&s.current.onClose(e(e({},m),{code:1006,reason:"An error occurred with the EventSource: ".concat(m),wasClean:!1})),d(t.ReadyState.CLOSED),l.close()),s.current.retryOnError)if(a.current<((i=s.current.reconnectAttempts)!==null&&i!==void 0?i:t.DEFAULT_RECONNECT_LIMIT)){var _=typeof s.current.reconnectInterval=="function"?s.current.reconnectInterval(a.current):s.current.reconnectInterval;h=window.setTimeout(function(){a.current++,n()},_??t.DEFAULT_RECONNECT_INTERVAL_MS)}else s.current.onReconnectStop&&s.current.onReconnectStop(s.current.reconnectAttempts),console.warn("Max reconnect attempts of ".concat(s.current.reconnectAttempts," exceeded"))},function(){return h&&window.clearTimeout(h)}},p=function(l,s,d,n,a,h,m){var i=s.setLastMessage,_=s.setReadyState,x,j,S;return d.current.fromSocketIO&&(x=(0,o.setUpSocketIOPing)(m)),v(l,d,i,h),b(l,d,_,a,h),j=g(l,d,_,n,a),S=f(l,d,_,n,a),function(){_(t.ReadyState.CLOSING),j(),S(),l.close(),x&&clearInterval(x)}};return R.attachListeners=p,R}var W={},Ue;function ot(){if(Ue)return W;Ue=1;var e=W&&W.__assign||function(){return e=Object.assign||function(s){for(var d,n=1,a=arguments.length;n<a;n++){d=arguments[n];for(var h in d)Object.prototype.hasOwnProperty.call(d,h)&&(s[h]=d[h])}return s},e.apply(this,arguments)};Object.defineProperty(W,"__esModule",{value:!0}),W.attachSharedListeners=void 0;var o=be(),c=C(),t=_e(),u=ge(),v=Ze(),b=function(s,d,n){s.onmessage=function(a){(0,t.getSubscribers)(d).forEach(function(h){var m;h.optionsRef.current.onMessage&&h.optionsRef.current.onMessage(a),typeof((m=h==null?void 0:h.lastMessageTime)===null||m===void 0?void 0:m.current)=="number"&&(h.lastMessageTime.current=Date.now()),!(typeof h.optionsRef.current.filter=="function"&&h.optionsRef.current.filter(a)!==!0)&&(n&&typeof n!="boolean"&&(n==null?void 0:n.returnMessage)===a.data||h.setLastMessage(a))})}},g=function(s,d,n){s.onopen=function(a){var h=(0,t.getSubscribers)(d);h.forEach(function(m){m.reconnectCount.current=0,m.optionsRef.current.onOpen&&m.optionsRef.current.onOpen(a),m.setReadyState(c.ReadyState.OPEN),n&&s instanceof WebSocket&&(m.lastMessageTime.current=Date.now())}),n&&s instanceof WebSocket&&(0,v.heartbeat)(s,h.map(function(m){return m.lastMessageTime}),typeof n=="boolean"?void 0:n)}},f=function(s,d){s instanceof WebSocket&&(s.onclose=function(n){(0,t.getSubscribers)(d).forEach(function(a){a.optionsRef.current.onClose&&a.optionsRef.current.onClose(n),a.setReadyState(c.ReadyState.CLOSED)}),delete o.sharedWebSockets[d],(0,t.getSubscribers)(d).forEach(function(a){var h;if(a.optionsRef.current.shouldReconnect&&a.optionsRef.current.shouldReconnect(n)){var m=(h=a.optionsRef.current.reconnectAttempts)!==null&&h!==void 0?h:c.DEFAULT_RECONNECT_LIMIT;if(a.reconnectCount.current<m){var i=typeof a.optionsRef.current.reconnectInterval=="function"?a.optionsRef.current.reconnectInterval(a.reconnectCount.current):a.optionsRef.current.reconnectInterval;setTimeout(function(){a.reconnectCount.current++,a.reconnect.current()},i??c.DEFAULT_RECONNECT_INTERVAL_MS)}else a.optionsRef.current.onReconnectStop&&a.optionsRef.current.onReconnectStop(a.optionsRef.current.reconnectAttempts),console.warn("Max reconnect attempts of ".concat(m," exceeded"))}})})},p=function(s,d){s.onerror=function(n){(0,t.getSubscribers)(d).forEach(function(a){a.optionsRef.current.onError&&a.optionsRef.current.onError(n),c.isEventSourceSupported&&s instanceof EventSource&&(a.optionsRef.current.onClose&&a.optionsRef.current.onClose(e(e({},n),{code:1006,reason:"An error occurred with the EventSource: ".concat(n),wasClean:!1})),a.setReadyState(c.ReadyState.CLOSED))}),c.isEventSourceSupported&&s instanceof EventSource&&s.close()}},l=function(s,d,n,a){var h;return n.current.fromSocketIO&&(h=(0,u.setUpSocketIOPing)(a)),b(s,d,n.current.heartbeat),f(s,d),g(s,d,n.current.heartbeat),p(s,d),function(){h&&clearInterval(h)}};return W.attachSharedListeners=l,W}var qe;function it(){if(qe)return Z;qe=1,Object.defineProperty(Z,"__esModule",{value:!0}),Z.createOrJoinSocket=void 0;var e=be(),o=C(),c=ct(),t=ot(),u=_e(),v=function(g,f,p,l,s){return function(){if((0,u.removeSubscriber)(g,f),!(0,u.hasSubscribers)(g)){try{var d=e.sharedWebSockets[g];d instanceof WebSocket&&(d.onclose=function(n){p.current.onClose&&p.current.onClose(n),l(o.ReadyState.CLOSED)}),d.close()}catch{}s&&s(),delete e.sharedWebSockets[g]}}},b=function(g,f,p,l,s,d,n,a,h){if(!o.isEventSourceSupported&&l.current.eventSourceOptions)throw o.isReactNative?new Error("EventSource is not supported in ReactNative"):new Error("EventSource is not supported");if(l.current.share){var m=null;e.sharedWebSockets[f]===void 0?(e.sharedWebSockets[f]=l.current.eventSourceOptions?new EventSource(f,l.current.eventSourceOptions):new WebSocket(f,l.current.protocols),g.current=e.sharedWebSockets[f],p(o.ReadyState.CONNECTING),m=(0,t.attachSharedListeners)(e.sharedWebSockets[f],f,l,h)):(g.current=e.sharedWebSockets[f],p(e.sharedWebSockets[f].readyState));var i={setLastMessage:s,setReadyState:p,optionsRef:l,reconnectCount:n,lastMessageTime:a,reconnect:d};return(0,u.addSubscriber)(f,i),v(f,i,l,p,m)}else{if(g.current=l.current.eventSourceOptions?new EventSource(f,l.current.eventSourceOptions):new WebSocket(f,l.current.protocols),p(o.ReadyState.CONNECTING),!g.current)throw new Error("WebSocket failed to be created");return(0,c.attachListeners)(g.current,{setLastMessage:s,setReadyState:p},l,d.current,n,a,h)}};return Z.createOrJoinSocket=b,Z}var D={},Fe;function ut(){return Fe||(Fe=1,(function(e){var o=D&&D.__awaiter||function(f,p,l,s){function d(n){return n instanceof l?n:new l(function(a){a(n)})}return new(l||(l=Promise))(function(n,a){function h(_){try{i(s.next(_))}catch(x){a(x)}}function m(_){try{i(s.throw(_))}catch(x){a(x)}}function i(_){_.done?n(_.value):d(_.value).then(h,m)}i((s=s.apply(f,p||[])).next())})},c=D&&D.__generator||function(f,p){var l={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},s,d,n,a=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return a.next=h(0),a.throw=h(1),a.return=h(2),typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function h(i){return function(_){return m([i,_])}}function m(i){if(s)throw new TypeError("Generator is already executing.");for(;a&&(a=0,i[0]&&(l=0)),l;)try{if(s=1,d&&(n=i[0]&2?d.return:i[0]?d.throw||((n=d.return)&&n.call(d),0):d.next)&&!(n=n.call(d,i[1])).done)return n;switch(d=0,n&&(i=[i[0]&2,n.value]),i[0]){case 0:case 1:n=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,d=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(n=l.trys,!(n=n.length>0&&n[n.length-1])&&(i[0]===6||i[0]===2)){l=0;continue}if(i[0]===3&&(!n||i[1]>n[0]&&i[1]<n[3])){l.label=i[1];break}if(i[0]===6&&l.label<n[1]){l.label=n[1],n=i;break}if(n&&l.label<n[2]){l.label=n[2],l.ops.push(i);break}n[2]&&l.ops.pop(),l.trys.pop();continue}i=p.call(f,l)}catch(_){i=[6,_],d=0}finally{s=n=0}if(i[0]&5)throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},t=D&&D.__spreadArray||function(f,p,l){if(l||arguments.length===2)for(var s=0,d=p.length,n;s<d;s++)(n||!(s in p))&&(n||(n=Array.prototype.slice.call(p,0,s)),n[s]=p[s]);return f.concat(n||Array.prototype.slice.call(p))};Object.defineProperty(e,"__esModule",{value:!0}),e.getUrl=void 0;var u=ge(),v=C(),b=function(f){return new Promise(function(p){return window.setTimeout(p,f)})},g=function(f,p){for(var l=[],s=2;s<arguments.length;s++)l[s-2]=arguments[s];return o(void 0,t([f,p],l,!0),void 0,function(d,n,a){var h,m,i,_,x,j,S,y;return a===void 0&&(a=0),c(this,function(E){switch(E.label){case 0:if(typeof d!="function")return[3,10];E.label=1;case 1:return E.trys.push([1,3,,9]),[4,d()];case 2:return h=E.sent(),[3,9];case 3:return E.sent(),n.current.retryOnError?(m=(j=n.current.reconnectAttempts)!==null&&j!==void 0?j:v.DEFAULT_RECONNECT_LIMIT,a<m?(i=typeof n.current.reconnectInterval=="function"?n.current.reconnectInterval(a):n.current.reconnectInterval,[4,b(i??v.DEFAULT_RECONNECT_INTERVAL_MS)]):[3,5]):[3,7];case 4:return E.sent(),[2,(0,e.getUrl)(d,n,a+1)];case 5:return(y=(S=n.current).onReconnectStop)===null||y===void 0||y.call(S,a),[2,null];case 6:return[3,8];case 7:return[2,null];case 8:return[3,9];case 9:return[3,11];case 10:h=d,E.label=11;case 11:return _=n.current.fromSocketIO?(0,u.parseSocketIOUrl)(h):h,x=n.current.queryParams?(0,u.appendQueryParams)(_,n.current.queryParams):_,[2,x]}})})};e.getUrl=g})(D)),D}var de={},Ge;function lt(){return Ge||(Ge=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.websocketWrapper=void 0;var o=function(c,t){return new Proxy(c,{get:function(u,v){var b=u[v];return v==="reconnect"?t:typeof b=="function"?(console.error("Calling methods directly on the websocket is not supported at this moment. You must use the methods returned by useWebSocket."),function(){}):b},set:function(u,v,b){return/^on/.test(v)?(console.warn("The websocket's event handlers should be defined through the options object passed into useWebSocket."),!1):(u[v]=b,!0)}})};e.websocketWrapper=o,e.default=e.websocketWrapper})(de)),de}var Be;function je(){if(Be)return O;Be=1;var e=O&&O.__assign||function(){return e=Object.assign||function(d){for(var n,a=1,h=arguments.length;a<h;a++){n=arguments[a];for(var m in n)Object.prototype.hasOwnProperty.call(n,m)&&(d[m]=n[m])}return d},e.apply(this,arguments)},o=O&&O.__awaiter||function(d,n,a,h){function m(i){return i instanceof a?i:new a(function(_){_(i)})}return new(a||(a=Promise))(function(i,_){function x(y){try{S(h.next(y))}catch(E){_(E)}}function j(y){try{S(h.throw(y))}catch(E){_(E)}}function S(y){y.done?i(y.value):m(y.value).then(x,j)}S((h=h.apply(d,n||[])).next())})},c=O&&O.__generator||function(d,n){var a={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},h,m,i,_=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return _.next=x(0),_.throw=x(1),_.return=x(2),typeof Symbol=="function"&&(_[Symbol.iterator]=function(){return this}),_;function x(S){return function(y){return j([S,y])}}function j(S){if(h)throw new TypeError("Generator is already executing.");for(;_&&(_=0,S[0]&&(a=0)),a;)try{if(h=1,m&&(i=S[0]&2?m.return:S[0]?m.throw||((i=m.return)&&i.call(m),0):m.next)&&!(i=i.call(m,S[1])).done)return i;switch(m=0,i&&(S=[S[0]&2,i.value]),S[0]){case 0:case 1:i=S;break;case 4:return a.label++,{value:S[1],done:!1};case 5:a.label++,m=S[1],S=[0];continue;case 7:S=a.ops.pop(),a.trys.pop();continue;default:if(i=a.trys,!(i=i.length>0&&i[i.length-1])&&(S[0]===6||S[0]===2)){a=0;continue}if(S[0]===3&&(!i||S[1]>i[0]&&S[1]<i[3])){a.label=S[1];break}if(S[0]===6&&a.label<i[1]){a.label=i[1],i=S;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(S);break}i[2]&&a.ops.pop(),a.trys.pop();continue}S=n.call(d,a)}catch(y){S=[6,y],m=0}finally{h=i=0}if(S[0]&5)throw S[1];return{value:S[0]?S[1]:void 0,done:!0}}},t=O&&O.__importDefault||function(d){return d&&d.__esModule?d:{default:d}};Object.defineProperty(O,"__esModule",{value:!0}),O.useWebSocket=void 0;var u=ve(),v=vr(),b=C(),g=it(),f=ut(),p=t(lt()),l=Se(),s=function(d,n,a){n===void 0&&(n=b.DEFAULT_OPTIONS),a===void 0&&(a=!0);var h=(0,u.useState)(null),m=h[0],i=h[1],_=(0,u.useState)({}),x=_[0],j=_[1],S=(0,u.useMemo)(function(){if(!n.disableJson&&m)try{return JSON.parse(m.data)}catch{return b.UNPARSABLE_JSON_OBJECT}return null},[m,n.disableJson]),y=(0,u.useRef)(null),E=(0,u.useRef)(null),F=(0,u.useRef)(function(){}),G=(0,u.useRef)(0),ae=(0,u.useRef)(Date.now()),Y=(0,u.useRef)([]),L=(0,u.useRef)(null),B=(0,u.useRef)(n);B.current=n;var se=y.current&&x[y.current]!==void 0?x[y.current]:d!==null&&a===!0?b.ReadyState.CONNECTING:b.ReadyState.UNINSTANTIATED,$e=n.queryParams?JSON.stringify(n.queryParams):null,H=(0,u.useCallback)(function(N,k){var J;if(k===void 0&&(k=!0),b.isEventSourceSupported&&E.current instanceof EventSource){console.warn("Unable to send a message from an eventSource");return}((J=E.current)===null||J===void 0?void 0:J.readyState)===b.ReadyState.OPEN?((0,l.assertIsWebSocket)(E.current,B.current.skipAssert),E.current.send(N)):k&&Y.current.push(N)},[]),er=(0,u.useCallback)(function(N,k){k===void 0&&(k=!0),H(JSON.stringify(N),k)},[H]),rr=(0,u.useCallback)(function(){return B.current.share!==!0||b.isEventSourceSupported&&E.current instanceof EventSource?E.current:(L.current===null&&E.current&&((0,l.assertIsWebSocket)(E.current,B.current.skipAssert),L.current=(0,p.default)(E.current,F)),L.current)},[]);return(0,u.useEffect)(function(){if(d!==null&&a===!0){var N,k=!1,J=!0,ye=function(){return o(void 0,void 0,void 0,function(){var ee,z,xe;return c(this,function(Ee){switch(Ee.label){case 0:return ee=y,[4,(0,f.getUrl)(d,B)];case 1:return ee.current=Ee.sent(),y.current===null?(console.error("Failed to get a valid URL. WebSocket connection aborted."),y.current="ABORTED",(0,v.flushSync)(function(){return j(function(K){return e(e({},K),{ABORTED:b.ReadyState.CLOSED})})}),[2]):(z=function(K){k||(0,v.flushSync)(function(){return i(K)})},xe=function(K){k||(0,v.flushSync)(function(){return j(function(tr){var ce;return e(e({},tr),y.current&&(ce={},ce[y.current]=K,ce))})})},J&&(N=(0,g.createOrJoinSocket)(E,y.current,xe,B,z,F,G,ae,H)),[2])}})})};return F.current=function(){k||(L.current&&(L.current=null),N==null||N(),ye())},ye(),function(){k=!0,J=!1,L.current&&(L.current=null),N==null||N(),i(null)}}else(d===null||a===!1)&&(G.current=0,j(function(ee){var z;return e(e({},ee),y.current&&(z={},z[y.current]=b.ReadyState.CLOSED,z))}))},[d,a,$e,H]),(0,u.useEffect)(function(){se===b.ReadyState.OPEN&&Y.current.splice(0).forEach(function(N){H(N)})},[se]),{sendMessage:H,sendJsonMessage:er,lastMessage:m,lastJsonMessage:S,readyState:se,getWebSocket:rr}};return O.useWebSocket=s,O}var U={},He;function dt(){if(He)return U;He=1;var e=U&&U.__assign||function(){return e=Object.assign||function(g){for(var f,p=1,l=arguments.length;p<l;p++){f=arguments[p];for(var s in f)Object.prototype.hasOwnProperty.call(f,s)&&(g[s]=f[s])}return g},e.apply(this,arguments)};Object.defineProperty(U,"__esModule",{value:!0}),U.useSocketIO=void 0;var o=ve(),c=je(),t=C(),u={type:"empty",payload:null},v=function(g){if(!g||!g.data)return u;var f=g.data.match(/\[.*]/);if(!f)return u;var p=JSON.parse(f);return!Array.isArray(p)||!p[1]?u:{type:p[0],payload:p[1]}},b=function(g,f,p){f===void 0&&(f=t.DEFAULT_OPTIONS),p===void 0&&(p=!0);var l=(0,o.useMemo)(function(){return e(e({},f),{fromSocketIO:!0})},[]),s=(0,c.useWebSocket)(g,l,p),d=s.sendMessage,n=s.sendJsonMessage,a=s.lastMessage,h=s.readyState,m=s.getWebSocket,i=(0,o.useMemo)(function(){return v(a)},[a]);return{sendMessage:d,sendJsonMessage:n,lastMessage:i,lastJsonMessage:i,readyState:h,getWebSocket:m}};return U.useSocketIO=b,U}var M={},Je;function ft(){if(Je)return M;Je=1;var e=M&&M.__assign||function(){return e=Object.assign||function(b){for(var g,f=1,p=arguments.length;f<p;f++){g=arguments[f];for(var l in g)Object.prototype.hasOwnProperty.call(g,l)&&(b[l]=g[l])}return b},e.apply(this,arguments)},o=M&&M.__rest||function(b,g){var f={};for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&g.indexOf(p)<0&&(f[p]=b[p]);if(b!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,p=Object.getOwnPropertySymbols(b);l<p.length;l++)g.indexOf(p[l])<0&&Object.prototype.propertyIsEnumerable.call(b,p[l])&&(f[p[l]]=b[p[l]]);return f};Object.defineProperty(M,"__esModule",{value:!0}),M.useEventSource=void 0;var c=ve(),t=je(),u=C(),v=function(b,g,f){g===void 0&&(g=u.DEFAULT_EVENT_SOURCE_OPTIONS);var p=g.withCredentials,l=g.events,s=o(g,["withCredentials","events"]);f===void 0&&(f=!0);var d=e(e({},s),{eventSourceOptions:{withCredentials:p}}),n=(0,c.useRef)(u.EMPTY_EVENT_HANDLERS);l&&(n.current=l);var a=(0,t.useWebSocket)(b,d,f),h=a.lastMessage,m=a.readyState,i=a.getWebSocket;return(0,c.useEffect)(function(){h!=null&&h.type&&Object.entries(n.current).forEach(function(_){var x=_[0],j=_[1];x===h.type&&j(h)})},[h]),{lastEvent:h,readyState:m,getEventSource:i}};return M.useEventSource=v,M}var ze;function vt(){return ze||(ze=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.resetGlobalState=e.useEventSource=e.ReadyState=e.useSocketIO=e.default=void 0;var o=je();Object.defineProperty(e,"default",{enumerable:!0,get:function(){return o.useWebSocket}});var c=dt();Object.defineProperty(e,"useSocketIO",{enumerable:!0,get:function(){return c.useSocketIO}});var t=C();Object.defineProperty(e,"ReadyState",{enumerable:!0,get:function(){return t.ReadyState}});var u=ft();Object.defineProperty(e,"useEventSource",{enumerable:!0,get:function(){return u.useEventSource}});var v=Se();Object.defineProperty(e,"resetGlobalState",{enumerable:!0,get:function(){return v.resetGlobalState}})})(oe)),oe}var V=vt();const ht=nr(V);function te({title:e,color:o}){const c=`text-${o} text-sm`,t=`bg-${o}`;return r.jsxs("div",{className:"flex flex-col justify-center items-center gap-1 rounded-md px-2 col-span-2 md:col-span-1",children:[r.jsx("div",{className:q("w-4 h-4 rounded-full",t)}),r.jsx("div",{className:c,children:e})]})}function pt({state:e}){return e===V.ReadyState.OPEN?r.jsx(te,{title:"已连接",color:"success"}):e===V.ReadyState.CLOSED?r.jsx(te,{title:"已关闭",color:"primary"}):e===V.ReadyState.CONNECTING?r.jsx(te,{title:"连接中",color:"warning"}):e===V.ReadyState.CLOSING?r.jsx(te,{title:"关闭中",color:"warning"}):null}const Ve=[{label:"元事件",value:"meta_event"},{label:"消息",value:"message"},{label:"请求",value:"request"},{label:"通知",value:"notice"},{label:"消息发送",value:"message_sent"}],mt=e=>{const{filterTypes:o,onSelectionChange:c}=e;return r.jsx(Tr,{selectedKeys:o,onSelectionChange:t=>{t!=="all"&&(t==null?void 0:t.size)===0&&(t="all"),c(t)},label:"筛选消息类型",selectionMode:"multiple",className:"w-full",items:Ve,renderValue:t=>t.length===Ve.length?"全部":t.map(u=>{var v;return(v=u.data)==null?void 0:v.label}).join(","),children:t=>r.jsx(Cr,{value:t.value,children:t.label},t.value)})},bt=(e,o)=>r.jsx(mt,{filterTypes:e,onSelectionChange:o});function gt(e,o,c=!0){const[t,u]=w.useState([]),[v,b]=w.useState("all"),g=t.filter(n=>v==="all"||v.size===0?!0:ne(n)?v.has(n.post_type):wr(n)?v.has("request"):!1),{sendMessage:f,readyState:p}=ht(c?e:null,{share:!1,onMessage:w.useCallback(n=>{try{const a=JSON.parse(n.data);u(h=>{const m=[a,...h];return m.length>500?m.slice(0,500):m})}catch{Q.error("WebSocket 消息解析失败")}},[]),queryParams:{access_token:o},onError:n=>{Q.error("WebSocket 连接失败"),console.error("WebSocket error:",n)},onOpen:()=>{u([])}}),l=n=>{if(p!==V.ReadyState.OPEN)throw new Error("WebSocket 连接未建立");f(n)},s=w.useCallback(()=>{u([])},[]),d=bt(v,b);return{sendMessage:l,readyState:p,messageHistory:t,filteredMessages:g,filterTypes:v,setFilterTypes:b,FilterMessagesType:d,clearMessages:s}}function Zt(){const e=new URL(window.location.origin);e.port="3001",e.protocol="ws:";const o=e.href,[c,t]=Oe(we.wsDebugConfig,{url:o,token:""}),[u,v]=w.useState(c.url),[b,g]=w.useState(c.token),[f,p]=w.useState(!1),[l]=Oe(we.backgroundImage,""),s=!!l,{sendMessage:d,readyState:n,FilterMessagesType:a,filteredMessages:h,clearMessages:m}=gt(c.url,c.token,f);w.useEffect(()=>{const j=c.url===o||c.url==="",S=c.url&&c.url.includes("/api/Debug/ws");if(!j&&!S){v(c.url),g(c.token);return}(async()=>{try{const F=await(await fetch("/api/Debug/create",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}})).json();if(F.code===0){const G=F.data.token,ae=window.location.protocol==="https:"?"wss:":"ws:";if(G){const Y=`${ae}//${window.location.host}/api/Debug/ws`;t({url:Y,token:G}),v(Y),g(G)}}}catch(E){console.error("Failed to create debug adapter:",E)}})()},[]);const i=w.useCallback(()=>{let j=u;if(j.startsWith("/")&&(j=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}${j}`),!j.startsWith("ws://")&&!j.startsWith("wss://")){Q.error("WebSocket URL 不合法");return}t({url:j,token:b}),p(!0)},[u,b,t]),_=w.useCallback(()=>{p(!1)},[]),x=w.useCallback(()=>{t({url:"",token:""}),window.location.reload()},[t]);return r.jsxs(r.Fragment,{children:[r.jsx("title",{children:"Websocket调试 - NapCat WebUI"}),r.jsxs("div",{className:"h-[calc(100vh-4rem)] overflow-hidden flex flex-col p-2 md:p-4 gap-2 md:gap-4",children:[r.jsx(Qe,{className:q("flex-shrink-0 backdrop-blur-xl border shadow-sm",s?"bg-white/10 dark:bg-black/10 border-white/40 dark:border-white/10":"bg-white/60 dark:bg-black/40 border-white/40 dark:border-white/10"),children:r.jsxs(Ye,{className:"gap-3 p-3 md:p-4",children:[r.jsxs("div",{className:"grid gap-3 items-end md:grid-cols-[1fr_1fr_auto]",children:[r.jsx(Ne,{label:"WebSocket URL",type:"text",value:u,onChange:j=>v(j.target.value),placeholder:"输入 WebSocket URL",size:"sm",variant:"bordered",classNames:{inputWrapper:q("backdrop-blur-sm border",s?"bg-white/10 border-white/20":"bg-default-100/50 border-default-200/50"),label:s?"text-white/80":"",input:s?"text-white placeholder:text-white/50":""}}),r.jsx(Ne,{label:"Token",type:"text",value:b,onChange:j=>g(j.target.value),placeholder:"输入 Token (可选)",size:"sm",variant:"bordered",classNames:{inputWrapper:q("backdrop-blur-sm border",s?"bg-white/10 border-white/20":"bg-default-100/50 border-default-200/50"),label:s?"text-white/80":"",input:s?"text-white placeholder:text-white/50":""}}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx(P,{isIconOnly:!0,size:"md",radius:"full",color:"warning",variant:"flat",onPress:x,title:"重置配置",children:r.jsx(pr,{className:"text-xl"})}),r.jsx(P,{onPress:f?_:i,size:"md",radius:"full",color:f?"danger":"primary",className:"font-bold shadow-lg min-w-[100px] flex-1",startContent:f?r.jsx(mr,{}):r.jsx(br,{}),children:f?"断开":"连接"})]})]}),r.jsxs("div",{className:q("p-2.5 rounded-xl border transition-colors flex flex-col md:flex-row gap-3 md:items-center md:justify-between",s?"bg-white/10 border-white/20":"bg-white/50 dark:bg-white/5 border-white/20"),children:[r.jsxs("div",{className:"flex items-center gap-3 w-full md:w-auto",children:[r.jsx("div",{className:"flex-shrink-0",children:r.jsx(pt,{state:n})}),r.jsx("div",{className:"flex-1 md:w-56 overflow-hidden",children:a})]}),r.jsxs("div",{className:"flex gap-2 justify-end w-full md:w-auto pt-1 md:pt-0 border-t border-white/5 md:border-t-0",children:[r.jsx(P,{size:"sm",color:"danger",variant:"flat",radius:"full",className:"font-medium",onPress:m,children:"清空日志"}),r.jsx(st,{sendMessage:d})]})]})]})}),r.jsx("div",{className:q("flex-1 overflow-hidden rounded-2xl border backdrop-blur-xl",s?"bg-white/10 dark:bg-black/10 border-white/40 dark:border-white/10":"bg-white/60 dark:bg-black/40 border-white/40 dark:border-white/10"),children:r.jsx(at,{messages:h})})]})]})}export{Zt as default};
