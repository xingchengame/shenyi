import{R as y,j as u,h as I}from"./codemirror-core-DIzFijqu.js";import{b as T,s as Ne}from"./index-B0DyBq9P.js";import{c as xe,a as Me}from"./chunk-5PILOUBS-C2iqzQ1E.js";import{i as se}from"./chunk-MLPFQTYO-6EVO19Sj.js";import{t as ve,a as X}from"./chunk-ML27DD5T-CMfbU3IH.js";import{x as ye,C as Re,D as Q}from"./react-dom-TsCL3mk_.js";import{l as be}from"./chunk-OPTZHMJX-Cx2b748P.js";import{P as Ae,H as Pe,t as K,T as Ie}from"./pure-DfQie5W0.js";import{a as Le,b as Z}from"./index-CtZU_f5P.js";import{a as J}from"./chunk-SXMLSBOY-CAmQOhGG.js";import{s as Se,l as Qe}from"./chunk-KVDW62ZT-CdlHxaox.js";import{a as je}from"./index-OutTOxJU.js";import{Q as F}from"./qq_manager-EQj02-Fv.js";import{u as Oe}from"./use-dialog-CRavAmtS.js";import"./chunk-WQVQ7P2I-B4KcTpLM.js";import"./index-CokAva9Y.js";import"./Item-DvdRZmps.js";import"./chunk-EN4B57RQ-CeMxVeoS.js";import"./icons-DCS2NAJ5.js";import"./chunk-6LIX6LVT-v4ufXNaW.js";import"./iconBase-ClXMXqAg.js";import"./chunk-CAFRINWI-CcU5yOMx.js";import"./chunk-SLABUSGS-BX9EgnNv.js";import"./chunk-AXSF7SRE-xAGcR_TS.js";var ze=Object.defineProperty,D=Object.getOwnPropertySymbols,re=Object.prototype.hasOwnProperty,ne=Object.prototype.propertyIsEnumerable,ee=(l,i,o)=>i in l?ze(l,i,{enumerable:!0,configurable:!0,writable:!0,value:o}):l[i]=o,$=(l,i)=>{for(var o in i||(i={}))re.call(i,o)&&ee(l,o,i[o]);if(D)for(var o of D(i))ne.call(i,o)&&ee(l,o,i[o]);return l},H=(l,i)=>{var o={};for(var c in l)re.call(l,c)&&i.indexOf(c)<0&&(o[c]=l[c]);if(l!=null&&D)for(var c of D(l))i.indexOf(c)<0&&ne.call(l,c)&&(o[c]=l[c]);return o};/**
 * @license QR Code generator library (TypeScript)
 * Copyright (c) Project Nayuki.
 * SPDX-License-Identifier: MIT
 */var j;(l=>{const i=class C{constructor(e,s,t,r){if(this.version=e,this.errorCorrectionLevel=s,this.modules=[],this.isFunction=[],e<C.MIN_VERSION||e>C.MAX_VERSION)throw new RangeError("Version value out of range");if(r<-1||r>7)throw new RangeError("Mask value out of range");this.size=e*4+17;let n=[];for(let a=0;a<this.size;a++)n.push(!1);for(let a=0;a<this.size;a++)this.modules.push(n.slice()),this.isFunction.push(n.slice());this.drawFunctionPatterns();const h=this.addEccAndInterleave(t);if(this.drawCodewords(h),r==-1){let a=1e9;for(let g=0;g<8;g++){this.applyMask(g),this.drawFormatBits(g);const f=this.getPenaltyScore();f<a&&(r=g,a=f),this.applyMask(g)}}m(0<=r&&r<=7),this.mask=r,this.applyMask(r),this.drawFormatBits(r),this.isFunction=[]}static encodeText(e,s){const t=l.QrSegment.makeSegments(e);return C.encodeSegments(t,s)}static encodeBinary(e,s){const t=l.QrSegment.makeBytes(e);return C.encodeSegments([t],s)}static encodeSegments(e,s,t=1,r=40,n=-1,h=!0){if(!(C.MIN_VERSION<=t&&t<=r&&r<=C.MAX_VERSION)||n<-1||n>7)throw new RangeError("Invalid value");let a,g;for(a=t;;a++){const p=C.getNumDataCodewords(a,s)*8,v=x.getTotalBits(e,a);if(v<=p){g=v;break}if(a>=r)throw new RangeError("Data too long")}for(const p of[C.Ecc.MEDIUM,C.Ecc.QUARTILE,C.Ecc.HIGH])h&&g<=C.getNumDataCodewords(a,p)*8&&(s=p);let f=[];for(const p of e){o(p.mode.modeBits,4,f),o(p.numChars,p.mode.numCharCountBits(a),f);for(const v of p.getData())f.push(v)}m(f.length==g);const R=C.getNumDataCodewords(a,s)*8;m(f.length<=R),o(0,Math.min(4,R-f.length),f),o(0,(8-f.length%8)%8,f),m(f.length%8==0);for(let p=236;f.length<R;p^=253)o(p,8,f);let M=[];for(;M.length*8<f.length;)M.push(0);return f.forEach((p,v)=>M[v>>>3]|=p<<7-(v&7)),new C(a,s,M,n)}getModule(e,s){return 0<=e&&e<this.size&&0<=s&&s<this.size&&this.modules[s][e]}getModules(){return this.modules}drawFunctionPatterns(){for(let t=0;t<this.size;t++)this.setFunctionModule(6,t,t%2==0),this.setFunctionModule(t,6,t%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const e=this.getAlignmentPatternPositions(),s=e.length;for(let t=0;t<s;t++)for(let r=0;r<s;r++)t==0&&r==0||t==0&&r==s-1||t==s-1&&r==0||this.drawAlignmentPattern(e[t],e[r]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(e){const s=this.errorCorrectionLevel.formatBits<<3|e;let t=s;for(let n=0;n<10;n++)t=t<<1^(t>>>9)*1335;const r=(s<<10|t)^21522;m(r>>>15==0);for(let n=0;n<=5;n++)this.setFunctionModule(8,n,c(r,n));this.setFunctionModule(8,7,c(r,6)),this.setFunctionModule(8,8,c(r,7)),this.setFunctionModule(7,8,c(r,8));for(let n=9;n<15;n++)this.setFunctionModule(14-n,8,c(r,n));for(let n=0;n<8;n++)this.setFunctionModule(this.size-1-n,8,c(r,n));for(let n=8;n<15;n++)this.setFunctionModule(8,this.size-15+n,c(r,n));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let e=this.version;for(let t=0;t<12;t++)e=e<<1^(e>>>11)*7973;const s=this.version<<12|e;m(s>>>18==0);for(let t=0;t<18;t++){const r=c(s,t),n=this.size-11+t%3,h=Math.floor(t/3);this.setFunctionModule(n,h,r),this.setFunctionModule(h,n,r)}}drawFinderPattern(e,s){for(let t=-4;t<=4;t++)for(let r=-4;r<=4;r++){const n=Math.max(Math.abs(r),Math.abs(t)),h=e+r,a=s+t;0<=h&&h<this.size&&0<=a&&a<this.size&&this.setFunctionModule(h,a,n!=2&&n!=4)}}drawAlignmentPattern(e,s){for(let t=-2;t<=2;t++)for(let r=-2;r<=2;r++)this.setFunctionModule(e+r,s+t,Math.max(Math.abs(r),Math.abs(t))!=1)}setFunctionModule(e,s,t){this.modules[s][e]=t,this.isFunction[s][e]=!0}addEccAndInterleave(e){const s=this.version,t=this.errorCorrectionLevel;if(e.length!=C.getNumDataCodewords(s,t))throw new RangeError("Invalid argument");const r=C.NUM_ERROR_CORRECTION_BLOCKS[t.ordinal][s],n=C.ECC_CODEWORDS_PER_BLOCK[t.ordinal][s],h=Math.floor(C.getNumRawDataModules(s)/8),a=r-h%r,g=Math.floor(h/r);let f=[];const R=C.reedSolomonComputeDivisor(n);for(let p=0,v=0;p<r;p++){let w=e.slice(v,v+g-n+(p<a?0:1));v+=w.length;const b=C.reedSolomonComputeRemainder(w,R);p<a&&w.push(0),f.push(w.concat(b))}let M=[];for(let p=0;p<f[0].length;p++)f.forEach((v,w)=>{(p!=g-n||w>=a)&&M.push(v[p])});return m(M.length==h),M}drawCodewords(e){if(e.length!=Math.floor(C.getNumRawDataModules(this.version)/8))throw new RangeError("Invalid argument");let s=0;for(let t=this.size-1;t>=1;t-=2){t==6&&(t=5);for(let r=0;r<this.size;r++)for(let n=0;n<2;n++){const h=t-n,g=(t+1&2)==0?this.size-1-r:r;!this.isFunction[g][h]&&s<e.length*8&&(this.modules[g][h]=c(e[s>>>3],7-(s&7)),s++)}}m(s==e.length*8)}applyMask(e){if(e<0||e>7)throw new RangeError("Mask value out of range");for(let s=0;s<this.size;s++)for(let t=0;t<this.size;t++){let r;switch(e){case 0:r=(t+s)%2==0;break;case 1:r=s%2==0;break;case 2:r=t%3==0;break;case 3:r=(t+s)%3==0;break;case 4:r=(Math.floor(t/3)+Math.floor(s/2))%2==0;break;case 5:r=t*s%2+t*s%3==0;break;case 6:r=(t*s%2+t*s%3)%2==0;break;case 7:r=((t+s)%2+t*s%3)%2==0;break;default:throw new Error("Unreachable")}!this.isFunction[s][t]&&r&&(this.modules[s][t]=!this.modules[s][t])}}getPenaltyScore(){let e=0;for(let n=0;n<this.size;n++){let h=!1,a=0,g=[0,0,0,0,0,0,0];for(let f=0;f<this.size;f++)this.modules[n][f]==h?(a++,a==5?e+=C.PENALTY_N1:a>5&&e++):(this.finderPenaltyAddHistory(a,g),h||(e+=this.finderPenaltyCountPatterns(g)*C.PENALTY_N3),h=this.modules[n][f],a=1);e+=this.finderPenaltyTerminateAndCount(h,a,g)*C.PENALTY_N3}for(let n=0;n<this.size;n++){let h=!1,a=0,g=[0,0,0,0,0,0,0];for(let f=0;f<this.size;f++)this.modules[f][n]==h?(a++,a==5?e+=C.PENALTY_N1:a>5&&e++):(this.finderPenaltyAddHistory(a,g),h||(e+=this.finderPenaltyCountPatterns(g)*C.PENALTY_N3),h=this.modules[f][n],a=1);e+=this.finderPenaltyTerminateAndCount(h,a,g)*C.PENALTY_N3}for(let n=0;n<this.size-1;n++)for(let h=0;h<this.size-1;h++){const a=this.modules[n][h];a==this.modules[n][h+1]&&a==this.modules[n+1][h]&&a==this.modules[n+1][h+1]&&(e+=C.PENALTY_N2)}let s=0;for(const n of this.modules)s=n.reduce((h,a)=>h+(a?1:0),s);const t=this.size*this.size,r=Math.ceil(Math.abs(s*20-t*10)/t)-1;return m(0<=r&&r<=9),e+=r*C.PENALTY_N4,m(0<=e&&e<=2568888),e}getAlignmentPatternPositions(){if(this.version==1)return[];{const e=Math.floor(this.version/7)+2,s=this.version==32?26:Math.ceil((this.version*4+4)/(e*2-2))*2;let t=[6];for(let r=this.size-7;t.length<e;r-=s)t.splice(1,0,r);return t}}static getNumRawDataModules(e){if(e<C.MIN_VERSION||e>C.MAX_VERSION)throw new RangeError("Version number out of range");let s=(16*e+128)*e+64;if(e>=2){const t=Math.floor(e/7)+2;s-=(25*t-10)*t-55,e>=7&&(s-=36)}return m(208<=s&&s<=29648),s}static getNumDataCodewords(e,s){return Math.floor(C.getNumRawDataModules(e)/8)-C.ECC_CODEWORDS_PER_BLOCK[s.ordinal][e]*C.NUM_ERROR_CORRECTION_BLOCKS[s.ordinal][e]}static reedSolomonComputeDivisor(e){if(e<1||e>255)throw new RangeError("Degree out of range");let s=[];for(let r=0;r<e-1;r++)s.push(0);s.push(1);let t=1;for(let r=0;r<e;r++){for(let n=0;n<s.length;n++)s[n]=C.reedSolomonMultiply(s[n],t),n+1<s.length&&(s[n]^=s[n+1]);t=C.reedSolomonMultiply(t,2)}return s}static reedSolomonComputeRemainder(e,s){let t=s.map(r=>0);for(const r of e){const n=r^t.shift();t.push(0),s.forEach((h,a)=>t[a]^=C.reedSolomonMultiply(h,n))}return t}static reedSolomonMultiply(e,s){if(e>>>8||s>>>8)throw new RangeError("Byte out of range");let t=0;for(let r=7;r>=0;r--)t=t<<1^(t>>>7)*285,t^=(s>>>r&1)*e;return m(t>>>8==0),t}finderPenaltyCountPatterns(e){const s=e[1];m(s<=this.size*3);const t=s>0&&e[2]==s&&e[3]==s*3&&e[4]==s&&e[5]==s;return(t&&e[0]>=s*4&&e[6]>=s?1:0)+(t&&e[6]>=s*4&&e[0]>=s?1:0)}finderPenaltyTerminateAndCount(e,s,t){return e&&(this.finderPenaltyAddHistory(s,t),s=0),s+=this.size,this.finderPenaltyAddHistory(s,t),this.finderPenaltyCountPatterns(t)}finderPenaltyAddHistory(e,s){s[0]==0&&(e+=this.size),s.pop(),s.unshift(e)}};i.MIN_VERSION=1,i.MAX_VERSION=40,i.PENALTY_N1=3,i.PENALTY_N2=3,i.PENALTY_N3=40,i.PENALTY_N4=10,i.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],i.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],l.QrCode=i;function o(E,e,s){if(e<0||e>31||E>>>e)throw new RangeError("Value out of range");for(let t=e-1;t>=0;t--)s.push(E>>>t&1)}function c(E,e){return(E>>>e&1)!=0}function m(E){if(!E)throw new Error("Assertion error")}const d=class N{constructor(e,s,t){if(this.mode=e,this.numChars=s,this.bitData=t,s<0)throw new RangeError("Invalid argument");this.bitData=t.slice()}static makeBytes(e){let s=[];for(const t of e)o(t,8,s);return new N(N.Mode.BYTE,e.length,s)}static makeNumeric(e){if(!N.isNumeric(e))throw new RangeError("String contains non-numeric characters");let s=[];for(let t=0;t<e.length;){const r=Math.min(e.length-t,3);o(parseInt(e.substring(t,t+r),10),r*3+1,s),t+=r}return new N(N.Mode.NUMERIC,e.length,s)}static makeAlphanumeric(e){if(!N.isAlphanumeric(e))throw new RangeError("String contains unencodable characters in alphanumeric mode");let s=[],t;for(t=0;t+2<=e.length;t+=2){let r=N.ALPHANUMERIC_CHARSET.indexOf(e.charAt(t))*45;r+=N.ALPHANUMERIC_CHARSET.indexOf(e.charAt(t+1)),o(r,11,s)}return t<e.length&&o(N.ALPHANUMERIC_CHARSET.indexOf(e.charAt(t)),6,s),new N(N.Mode.ALPHANUMERIC,e.length,s)}static makeSegments(e){return e==""?[]:N.isNumeric(e)?[N.makeNumeric(e)]:N.isAlphanumeric(e)?[N.makeAlphanumeric(e)]:[N.makeBytes(N.toUtf8ByteArray(e))]}static makeEci(e){let s=[];if(e<0)throw new RangeError("ECI assignment value out of range");if(e<128)o(e,8,s);else if(e<16384)o(2,2,s),o(e,14,s);else if(e<1e6)o(6,3,s),o(e,21,s);else throw new RangeError("ECI assignment value out of range");return new N(N.Mode.ECI,0,s)}static isNumeric(e){return N.NUMERIC_REGEX.test(e)}static isAlphanumeric(e){return N.ALPHANUMERIC_REGEX.test(e)}getData(){return this.bitData.slice()}static getTotalBits(e,s){let t=0;for(const r of e){const n=r.mode.numCharCountBits(s);if(r.numChars>=1<<n)return 1/0;t+=4+n+r.bitData.length}return t}static toUtf8ByteArray(e){e=encodeURI(e);let s=[];for(let t=0;t<e.length;t++)e.charAt(t)!="%"?s.push(e.charCodeAt(t)):(s.push(parseInt(e.substring(t+1,t+3),16)),t+=2);return s}};d.NUMERIC_REGEX=/^[0-9]*$/,d.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,d.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:";let x=d;l.QrSegment=d})(j||(j={}));(l=>{(i=>{const o=class{constructor(m,d){this.ordinal=m,this.formatBits=d}};o.LOW=new o(0,1),o.MEDIUM=new o(1,0),o.QUARTILE=new o(2,3),o.HIGH=new o(3,2),i.Ecc=o})(l.QrCode||(l.QrCode={}))})(j||(j={}));(l=>{(i=>{const o=class{constructor(m,d){this.modeBits=m,this.numBitsCharCount=d}numCharCountBits(m){return this.numBitsCharCount[Math.floor((m+7)/17)]}};o.NUMERIC=new o(1,[10,12,14]),o.ALPHANUMERIC=new o(2,[9,11,13]),o.BYTE=new o(4,[8,16,16]),o.KANJI=new o(8,[8,10,12]),o.ECI=new o(7,[0,0,0]),i.Mode=o})(l.QrSegment||(l.QrSegment={}))})(j||(j={}));var z=j;/**
 * @license qrcode.react
 * Copyright (c) Paul O'Shannessy
 * SPDX-License-Identifier: ISC
 */var _e={L:z.QrCode.Ecc.LOW,M:z.QrCode.Ecc.MEDIUM,Q:z.QrCode.Ecc.QUARTILE,H:z.QrCode.Ecc.HIGH},oe=128,ie="L",ae="#FFFFFF",le="#000000",ce=!1,ue=1,Fe=4,Te=0,ke=.1;function he(l,i=0){const o=[];return l.forEach(function(c,m){let d=null;c.forEach(function(x,E){if(!x&&d!==null){o.push(`M${d+i} ${m+i}h${E-d}v1H${d+i}z`),d=null;return}if(E===c.length-1){if(!x)return;d===null?o.push(`M${E+i},${m+i} h1v1H${E+i}z`):o.push(`M${d+i},${m+i} h${E+1-d}v1H${d+i}z`);return}x&&d===null&&(d=E)})}),o.join("")}function de(l,i){return l.slice().map((o,c)=>c<i.y||c>=i.y+i.h?o:o.map((m,d)=>d<i.x||d>=i.x+i.w?m:!1))}function De(l,i,o,c){if(c==null)return null;const m=l.length+o*2,d=Math.floor(i*ke),x=m/i,E=(c.width||d)*x,e=(c.height||d)*x,s=c.x==null?l.length/2-E/2:c.x*x,t=c.y==null?l.length/2-e/2:c.y*x,r=c.opacity==null?1:c.opacity;let n=null;if(c.excavate){let a=Math.floor(s),g=Math.floor(t),f=Math.ceil(E+s-a),R=Math.ceil(e+t-g);n={x:a,y:g,w:f,h:R}}const h=c.crossOrigin;return{x:s,y:t,h:e,w:E,excavation:n,opacity:r,crossOrigin:h}}function Ue(l,i){return i!=null?Math.max(Math.floor(i),0):l?Fe:Te}function fe({value:l,level:i,minVersion:o,includeMargin:c,marginSize:m,imageSettings:d,size:x,boostLevel:E}){let e=y.useMemo(()=>{const a=(Array.isArray(l)?l:[l]).reduce((g,f)=>(g.push(...z.QrSegment.makeSegments(f)),g),[]);return z.QrCode.encodeSegments(a,_e[i],o,void 0,void 0,E)},[l,i,o,E]);const{cells:s,margin:t,numCells:r,calculatedImageSettings:n}=y.useMemo(()=>{let h=e.getModules();const a=Ue(c,m),g=h.length+a*2,f=De(h,x,a,d);return{cells:h,margin:a,numCells:g,calculatedImageSettings:f}},[e,x,d,c,m]);return{qrcode:e,margin:t,cells:s,numCells:r,calculatedImageSettings:n}}var Be=(function(){try{new Path2D().addPath(new Path2D)}catch{return!1}return!0})(),$e=y.forwardRef(function(i,o){const c=i,{value:m,size:d=oe,level:x=ie,bgColor:E=ae,fgColor:e=le,includeMargin:s=ce,minVersion:t=ue,boostLevel:r,marginSize:n,imageSettings:h}=c,g=H(c,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","marginSize","imageSettings"]),{style:f}=g,R=H(g,["style"]),M=h==null?void 0:h.src,p=y.useRef(null),v=y.useRef(null),w=y.useCallback(S=>{p.current=S,typeof o=="function"?o(S):o&&(o.current=S)},[o]),[b,O]=y.useState(!1),{margin:L,cells:U,numCells:B,calculatedImageSettings:A}=fe({value:m,level:x,minVersion:t,boostLevel:r,includeMargin:s,marginSize:n,imageSettings:h,size:d});y.useEffect(()=>{if(p.current!=null){const S=p.current,P=S.getContext("2d");if(!P)return;let Y=U;const _=v.current,G=A!=null&&_!==null&&_.complete&&_.naturalHeight!==0&&_.naturalWidth!==0;G&&A.excavation!=null&&(Y=de(U,A.excavation));const q=window.devicePixelRatio||1;S.height=S.width=d*q;const W=d/B*q;P.scale(W,W),P.fillStyle=E,P.fillRect(0,0,B,B),P.fillStyle=e,Be?P.fill(new Path2D(he(Y,L))):U.forEach(function(pe,Ee){pe.forEach(function(Ce,we){Ce&&P.fillRect(we+L,Ee+L,1,1)})}),A&&(P.globalAlpha=A.opacity),G&&P.drawImage(_,A.x+L,A.y+L,A.w,A.h)}}),y.useEffect(()=>{O(!1)},[M]);const ge=$({height:d,width:d},f);let V=null;return M!=null&&(V=y.createElement("img",{src:M,key:M,style:{display:"none"},onLoad:()=>{O(!0)},ref:v,crossOrigin:A==null?void 0:A.crossOrigin})),y.createElement(y.Fragment,null,y.createElement("canvas",$({style:ge,height:d,width:d,ref:w,role:"img"},R)),V)});$e.displayName="QRCodeCanvas";var me=y.forwardRef(function(i,o){const c=i,{value:m,size:d=oe,level:x=ie,bgColor:E=ae,fgColor:e=le,includeMargin:s=ce,minVersion:t=ue,boostLevel:r,title:n,marginSize:h,imageSettings:a}=c,g=H(c,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","title","marginSize","imageSettings"]),{margin:f,cells:R,numCells:M,calculatedImageSettings:p}=fe({value:m,level:x,minVersion:t,boostLevel:r,includeMargin:s,marginSize:h,imageSettings:a,size:d});let v=R,w=null;a!=null&&p!=null&&(p.excavation!=null&&(v=de(R,p.excavation)),w=y.createElement("image",{href:a.src,height:p.h,width:p.w,x:p.x+f,y:p.y+f,preserveAspectRatio:"none",opacity:p.opacity,crossOrigin:p.crossOrigin}));const b=he(v,f);return y.createElement("svg",$({height:d,width:d,viewBox:`0 0 ${M} ${M}`,ref:o,role:"img"},g),!!n&&y.createElement("title",null,n),y.createElement("path",{fill:E,d:`M0,0 h${M}v${M}H0z`,shapeRendering:"crispEdges"}),y.createElement("path",{fill:e,d:b,shapeRendering:"crispEdges"}),w)});me.displayName="QRCodeSVG";const He=({qrcode:l,loginError:i,onRefresh:o})=>u.jsx("div",{className:"flex flex-col items-center",children:i?u.jsxs("div",{className:"flex flex-col items-center py-4",children:[u.jsx("div",{className:"w-full flex justify-center mb-6",children:u.jsx("div",{className:"p-4 bg-danger-50 rounded-full",children:u.jsx(Le,{className:"text-danger",size:64})})}),u.jsxs("div",{className:"text-center space-y-2 px-4",children:[u.jsx("div",{className:"text-xl font-bold text-danger",children:"登录失败"}),u.jsx("div",{className:"text-default-600 text-sm leading-relaxed max-w-[300px]",children:i})]}),o&&u.jsx(T,{className:"mt-8 min-w-[160px]",variant:"solid",color:"primary",size:"lg",startContent:u.jsx(Z,{}),onPress:o,children:"重新获取二维码"})]}):u.jsxs(u.Fragment,{children:[u.jsxs("div",{className:"bg-white p-2 rounded-md w-fit mx-auto relative overflow-hidden",children:[!l&&u.jsx("div",{className:"absolute left-0 top-0 right-0 bottom-0 bg-white dark:bg-zinc-900 bg-opacity-90 backdrop-blur-sm flex items-center justify-center z-10",children:u.jsx(Ne,{color:"primary"})}),u.jsx(me,{size:180,value:l||" "})]}),u.jsx("div",{className:"mt-5 text-center text-default-500 text-sm",children:"请使用QQ或者TIM扫描上方二维码"}),o&&l&&u.jsx(T,{className:"mt-4",variant:"flat",color:"primary",size:"sm",startContent:u.jsx(Z,{}),onPress:o,children:"刷新二维码"})]})}),k=l=>!!l&&"nickName"in l&&"faceUrl"in l,Ve=({qqList:l,refresh:i,isLoading:o,selectedQQ:c,onUpdateQQList:m,handleSelectionChange:d,onSubmit:x})=>u.jsxs("div",{className:"flex flex-col gap-8",children:[u.jsx("div",{className:"flex justify-center",children:u.jsx(se,{className:"shadow-lg",height:100,radius:"full",src:`https://q1.qlogo.cn/g?b=qq&nk=${c||"0"}&s=100`,width:100})}),u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx(Se,{classNames:{popoverContent:"bg-opacity-50 backdrop-blur"},"aria-label":"QQ Login",isDisabled:i,items:l,placeholder:"请选择QQ",renderValue:E=>E.map(e=>{var s,t,r,n;return u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx(J,{alt:(s=e.key)==null?void 0:s.toString(),className:"flex-shrink-0",size:"sm",src:k(e.data)?(t=e.data)==null?void 0:t.faceUrl:`https://q1.qlogo.cn/g?b=qq&nk=${e.key}&s=1`}),u.jsx("div",{className:"flex flex-col",children:k(e.data)?`${e.data.nickName}(${(r=e.key)==null?void 0:r.toString()})`:(n=e.key)==null?void 0:n.toString()})]},e.key)}),selectedKeys:[c],size:"lg",onChange:d,children:E=>u.jsx(Qe,{textValue:E.uin,children:u.jsxs("div",{className:"flex items-center gap-2",children:[u.jsx(J,{alt:E.uin,className:"flex-shrink-0",size:"sm",src:k(E)?E.faceUrl:`https://q1.qlogo.cn/g?b=qq&nk=${E.uin}&s=1`}),u.jsx("div",{className:"flex flex-col",children:k(E)?`${E.nickName}(${E.uin})`:E.uin})]})},E.uin)}),u.jsx(T,{isIconOnly:!0,className:"flex-grow-0 flex-shrink-0",color:"secondary",isLoading:i,radius:"full",size:"lg",variant:"light",onPress:m,children:u.jsx(je,{size:24})})]}),u.jsx("div",{className:"flex justify-center mt-5",children:u.jsx(T,{className:"w-64 max-w-full",color:"primary",isLoading:o,radius:"full",size:"lg",variant:"shadow",onPress:x,children:"登录"})})]}),te=l=>{if(l.startsWith("登录失败: ")){const i=l.substring(6);try{const o=JSON.parse(i);if(Array.isArray(o)&&o[1]){const c=o[1],m=c.serverErrorCode?` (错误码: ${c.serverErrorCode})`:"";return`${c.message||l}${m}`}}catch{}}return l};function Ct(){const l=ye(),i=Oe(),[o,c]=I.useState(""),[m,d]=I.useState(!1),[x,E]=I.useState(""),[e,s]=I.useState(""),t=I.useRef(""),[r,n]=I.useState([]),[h,a]=I.useState(!1),g=I.useRef(!0),f=async()=>{if(!o){Q.error("请选择快捷登录的QQ");return}d(!0);try{await F.setQuickLogin(o)}catch(w){const b=w.message;Q.error(`快速登录QQ失败: ${b}`)}finally{setTimeout(()=>{d(!1)},1e3)}},R=async()=>{g.current&&d(!0);try{const w=await F.checkQQLoginStatusWithQrcode();if(g.current&&(d(!1),g.current=!1),w.isLogin)Q.success("QQ登录成功"),l("/",{replace:!0});else if(E(w.qrcodeurl),w.loginError&&w.loginError!==t.current){t.current=w.loginError,s(w.loginError);const b=te(w.loginError);i.alert({title:"登录失败",content:b,confirmText:"确定"})}else w.loginError||(t.current="",s(""))}catch(w){const b=w.message;Q.error(`获取二维码失败: ${b}`)}},M=async()=>{a(!0);try{const w=await F.getQQQuickLoginListNew();n(w)}catch{try{const O=(await F.getQQQuickLoginList()).map(L=>({uin:L}));n(O)}catch(b){const O=b.message;Q.error(`获取QQ列表失败: ${O}`)}}finally{a(!1)}},p=w=>{c(w.target.value)},v=async()=>{try{t.current="",s(""),await F.refreshQRCode(),Q.success("已发送刷新请求")}catch(w){const b=w.message;Q.error(`刷新二维码失败: ${b}`)}};return I.useEffect(()=>{const w=setInterval(()=>{R()},3e3);return R(),M(),()=>clearInterval(w)},[]),u.jsxs(u.Fragment,{children:[u.jsx("title",{children:"QQ登录 - NapCat WebUI"}),u.jsx(Ae,{children:u.jsx(Re.div,{initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},transition:{duration:.5,type:"spring",stiffness:120,damping:20},className:"w-[608px] max-w-full py-8 px-2 md:px-8 overflow-hidden",children:u.jsxs(Pe,{className:"items-center gap-4 pt-0 pb-6 bg-default-50",maxXRotation:3,maxYRotation:3,children:[u.jsxs(xe,{className:"inline-block max-w-lg text-center justify-center",children:[u.jsxs("div",{className:"flex items-center justify-center w-full gap-2 pt-10",children:[u.jsx(se,{alt:"logo",height:"7em",src:be}),u.jsxs("div",{children:[u.jsx("span",{className:K(),children:"Web "}),u.jsx("span",{className:K({color:"violet"}),children:"Login "})]})]}),u.jsx(Ie,{className:"absolute right-4 top-4"})]}),u.jsxs(Me,{className:"flex gap-5 p-10 pt-0",children:[u.jsxs(ve,{fullWidth:!0,classNames:{tabList:"shadow-sm dark:shadow-none"},isDisabled:m,size:"lg",children:[u.jsx(X,{title:"快速登录",children:u.jsx(Ve,{handleSelectionChange:p,isLoading:m,qqList:r,refresh:h,selectedQQ:o,onSubmit:f,onUpdateQQList:M})},"shortcut"),u.jsx(X,{title:"扫码登录",children:u.jsx(He,{loginError:te(e),qrcode:x,onRefresh:v})},"qrcode")]}),u.jsx(T,{className:"w-fit mx-auto",variant:"light",color:"primary",onPress:()=>{l("/web_login",{replace:!0})},children:"返回 Web Login"})]})]})})})]})}export{Ct as default};
